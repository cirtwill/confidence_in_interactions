
\documentclass[12pt]{article} 
\usepackage{amsmath} 
\usepackage[dvips]{graphicx}
\usepackage{multirow} 
\usepackage{geometry} 
\usepackage{pdflscape}
\usepackage[labelfont=bf]{caption} 
\usepackage{setspace}
\usepackage[running]{lineno} 
% \usepackage[numbers,sort]{natbib}
\usepackage[round]{natbib} 
\usepackage{array}

\newcommand{\methods}{\textit{Materials \& Methods}}
\newcommand{\SI}{\textit{Appendix}~}
\renewcommand{\thefigure}{S\arabic{figure}}
\renewcommand{\thetable}{S\arabic{table}}

\topmargin -1.5cm % 0.0cm 
\oddsidemargin 0.0cm % 0.2cm 
\textwidth 6.5in
\textheight 9.0in % 21cm
\footskip 1.0cm % 1.0cm

\usepackage{authblk}

\title{A quantitative framework for investigating the reliability of empirical network construction: supplemental information}


\author{Alyssa R. Cirtwill$^{1\dagger}$, \&  Anna Ekl\"{o}f$^{1}$, Tomas Roslin$^{2}$, Kate Wootton$^{2}$, Dominique Gravel$^{3}$}
\date{\small$^1$Department of Physics, Chemistry\\ 
and Biology (IFM)\\ 
Link\"{o}ping University\\
Link\"{o}ping, Sweden\\
\medskip $^2$ Department of Ecology\\ P.O. Box 7044, Swedish University of Agricultural Sciences \\ SE-750 07 Uppsala, Sweden \\
\medskip$^3$ D\'{e}partement de biologie\\ 
Universit\'{e} de Sherbrooke\\ 
Sherbrooke, Canada\\ 
\medskip
$^\dagger$ Corresponding author:\\
alyssa.cirtwill@gmail.com\\
+46 723 158464\\
}
\renewcommand\Authands{ and }

\begin{document} 
\maketitle 
\raggedright
\setlength{\parindent}{15pt} 
\clearpage

\linenumbers

\section*{Appendix S1: Simulating the effects of uncertainty on network structure}

  To demonstrate the effects of nested interaction, process, and detection uncertainty on network structure, we can observe how the structure of randomly-generated networks changes as we add layers of uncertainty. We began by constructing 100 ``true" networks with 50 consumer species, 50 resource species, and a connectance of 0.1. We ensured that each network had at least one link per consumer and per resource. For each network, we calculated the mean number of links per consumer, mean number of links per resource, and nestedness (NODF) as described in the main text. For simplicity, we assume that there is no interaction uncertainty in this system (i.e., all interactions are either 100\% feasible or 100\% unfeasible based on species' traits).


  Taking each ``true" network as a starting point, we then applied process uncertainty. The probability $p$ of the occurrence of each interaction on a given sampling day was assigned a random probability drawn from the uniform distribution. As the probability that an interaction will occur during sampling also depends on the probability of the two species co-occurring, we also assigned a random number of sampling days on which each species co-occurred. The number of co-occurrences, $n$, was drawn from a uniform distribution and could be any integer between 0 and 30 (our simulated number of sampling days), inclusive. The number of occurrences, $k$, of each interaction was then drawn from a binomial distribution based on $n$ and $p$. If the number of occurrences during sampling was greater than 0 and the interaction occurred in the true network, we included the interaction in the ``process-filtered" network. As the inclusion of interactions in the process matrices is random, we created 100 process-filtered networks for each true network. For each network, we calculated the number of consumers and resources (after removing any species with no interactions), mean links per consumer and per resource, connectance, and NODF.


  Next, we applied a layer of detection uncertainty to create ``detection-filtered" networks. As with the process-filtered networks, we randomly selected the number of times each species co-occurred, $n$, from a uniform distribution. We also randomly selected the probability, $p$, of detecting each interaction. To reflect the fact that some interactions are easy to observe but many will be more difficult (because one or both interaction partners are rare, cryptic, or difficult to rear in the lab), we drew $p$ from a beta distribution with shape parameters 2 and 10. We created 100 detection-filtered networks for each process-filtered network (10000 per true network). For each network, we calculated the number of consumers and resources (after removing any species with no interactions), mean links per consumer and per resource, connectance, and NODF. Code used in this simulation example is contained in the file \emph{simulation\_example.R}, uploaded separately.


  With each additional layer of uncertainty, the number of consumers and resources included in the web decreased (mean 49.8 of each species type in detection-filter webs and mean 48.6 of each type in process-filtered webs). The connectance and number of links per consumer and per resource decreased significantly at each level (Fig.~\ref{sim_props}A,B,D; $p$\textless0.001 in all cases based on one-tailed Student's t tests). The effects of uncertainty on nestedness were less predictable, particularly in the detection-filtered webs where variability was much higher than in other web types. Nevertheless, mean nestedness was lower in detection-filtered webs than in the original webs ($t$=19.9, $p$\textless0.001) and lower in the process-filtered webs than the original and detection-filtered webs (Fig.~\ref{sim_props}C; $t$=32.8, $p$\textless0.001 and $t$=93.7, $p$\textless0.001). We note that these tests may reflect the large number of detection-filtered webs generated by our simulation. A single observed network drawn from these detection-filtered webs might well have a higher nestedness than the ``true" network. This simulation demonstrates the fact that process and detection uncertainty mean that we are very unlikely to observe all of the interactions that can truly occur in a system, as well as the sometimes unpredictable effects this uncertainty can have on higher-order structures such as nestedness.


  Note that this simulation uses several simplifying assumptions. For instance, we treat interactions as independent and ignore the possibility for, for example, competition between resources. A thorough exploration of the effects of interaction contingency, different distributions of co-occurrences, etc. would be an interesting topic for future work but is beyond the scope of the current study. We also neglect interaction uncertainty in this example. Interaction uncertainty could be included by, for example, modelling interactions between individuals of each species. In this framework, individuals could vary in some trait (e.g., body size) that affects the interactions in which they participate. Very small or very large individuals might not participate in some interactions that are feasible for most members of the species. 


  \begin{figure}
  \label{sim_props}
  \caption{We created 100 random networks containing 50 consumers and 50 resources, with a connectance of 0.1. For each of these ``original" networks, we created 100 process-filtered (``process") networks incorporating uncertainty around the occurrence of each interaction during sampling. For each ``process" network, we further created 100 detection-filtered (``detection") networks incorporating uncertainty around the detection of each interaction. For each network, we show the mean (+/- SD) connectance, links per consumer, nestedness (NODF), and links per resource.}
  \begin{center}
  \includegraphics*[width=.9\textwidth]{figures/simulation_example.eps}
  \end{center}
  \end{figure}

\clearpage

\section*{Appendix S1-A: Attributions for PhyloPic images used in Figure 1 (main text)}

  \begin{table}
  \caption{Attributions for silhouette images taken from PhyloPic.org and used in Figure 1 (\emph{main text}). Terms for the CC BY-NC-SA 3.0 license can be found at \emph{https://creativecommons.org/licenses/by-nc-sa/3.0/}. Terms for the CC BY 3.0 license can be found at \emph{https://creativecommons.org/licenses/by/3.0/}.}
  \begin{tabular}{l|l m{10cm}}
  Image & PhyloPic taxon & Attribution \\
  \hline
  Lion & Panthera leo & Public domain (uncredited) \\
  Leopard & Panthera pardus & Lukasiniho (CC BY-NC-SA 3.0; image not changed) \\
  Jackal & Canidae & Brian Gratwicke (photo) and T. Michael Keesey (vectorization). (CC BY 3.0; image not changed) \\
  Elephant & Loxodonta africana & Jan A. Venter, Herbert H. T. Prins, David A. Balfour \& Rob Slotow (vectorized by T. Michael Keesey) (CC BY 3.0; image not changed) \\
  Zebra & Equus quagga & Cathy (CC BY-NC-SA 3.0; image not changed) \\
  Impala & Aepyceros melampus & Public domain (unknown author) \\
  Hare & Leporidae & Sarah Werning (CC A 3.0; image not changed) \\
  Acacia & Acacia & Mattia Menchetti (public domain) \\
  Grass & & Not sourced from PhyloPic. Public domain. \\
  \hline
  \end{tabular}
  \end{table}

\clearpage

\section*{Appendix S2: Mathematical framework}

  \subsection*{A naive quantification of uncertainty}

    We start by considering how to naively quantify an interaction probability and its associated uncertainty \emph{for an interaction that has not yet been observed}. Consider the case where a pair of species have been observed co-occurring $n$ times, of which they have been observed to interact in $k = 0$ cases. To evaluate the uncertainty of this interaction, consider the occurrence of an interaction as a Bernoulli trial. In this framework, the number of successes $k$ over $n$ trials will follow a binomial distribution: 
        
        \begin{equation}
          L \sim Bin(n,\lambda) ,
        \end{equation}


        \begin{equation}
           P(L = k|\lambda,n) = {n \choose k}\lambda^k(1-\lambda)^{n-k} . 
           \label{likelihood}
        \end{equation}

    \noindent The parameter $\lambda$, the probability of observing an interaction over an infinite time interval and area, is the quantity we want to estimate from empirical data. 
    The maximal likelihood estimate (MLE) of $\lambda$ is straightforward to find given $k$ and $n$:

        \begin{equation}
          \lambda_{MLE} = \frac{k}{n}  .
          \label{theta_MLE}
        \end{equation}


  \subsection*{Posterior distribution of the interaction probability}

    Here we adopt a Bayesian approach to estimate the posterior distribution of the parameter $\lambda$ :

    \begin{equation}
      \underbrace{P(\lambda|k,n)}_{Posterior} = \frac{\overbrace{P(k|\lambda,n)}^{Likelihood}\overbrace{P(\lambda)}^{Prior}}{\underbrace{P(k|N)}_{Normaliser}} .
      \label{posterior}
    \end{equation}

    According to the above description, the likelihood is simply the binomial distribution (Eq.~\ref{likelihood}). Since $\lambda$ is a probability, it is bounded between 0 and 1 and the most appropriate prior distribution is the beta:

    \begin{equation}
      \lambda \sim Beta(\alpha,\beta) , \label{prior}
    \end{equation}

    \noindent which has two shape parameters, $\alpha$ and $\beta$. 

   The beta-binomial distribution is a conjugate distribution of the binomial distribution. This allows us to analytically compute the posterior distribution of a binomial model with a beta prior distribution. We can re-write the posterior distribution of $\lambda$ as:

    \begin{equation}
      P(\lambda|k,n) = \frac{\lambda^{\alpha+k-1}(1-\lambda)^{\beta+n-k-1}}{B(\alpha+k,\beta+n-k)} , \label{posterior2}
    \end{equation}

    
    \noindent where the function $B$ is the beta function. The posterior distribution of $\lambda$ therefore follows the beta distribution with new parameters $\alpha'= \alpha+k$ and $\beta'=\beta+n-k$. 


    For interactions which were observed in at least one site ($k$\textgreater$0$), we can set the poseterior probability to 1 as long as the risk of a false positive is low. That is, when constructing a metaweb we can assume that an interaction observed at least once is truly feasible. The case study presented in the main text refers to a plant-galler network compiled by rearing galling insects obtained from galls; in each case, the plant-galler interaction definitely occurred and we are confident in the identification of both species involved (see \emph{Appendix S4} for details). Where the risk of false positives is higher (e.g., plant-pollinator networks where an observed flower visitor may not actually provide a pollination service), it may not be appropriate to assume $\lambda=$ wherever $k$\textgreater$0$. In such cases, we can model the posterior probabilities of observed interactions just as we do those that were not observed.


  \subsection*{Properties of the beta distribution}
  
    %   It is common to perform analyses that require calculating higher-order network properties in interaction networks. The fact that the posterior distribution of $\lambda$ follows a beta distribution makes it straightforward to compute moments and other properties needed for these analyses. 


    %   The \textbf{average} of $\lambda$ is: 
    %       \begin{equation}
    %         \bar{\lambda} = \frac{\alpha+k}{\alpha+\beta+n} ,
    %         \label{mean}
    %       \end{equation}

    %     and its \textbf{variance} is:  
    %       \begin{equation}
    %         Var(\lambda|k) = \frac{(\alpha + k)(\beta + n - k)}{(\alpha + \beta + n)^{2}(\alpha + \beta + n +1)}
    %         \label{variance}
    %       \end{equation}

    %     The \textbf{mode} of the distribution is:
    %       \begin{equation}
    %         \hat{\lambda} = \frac{\alpha + k - 1}{\alpha + \beta + n - 2} .
    %         \label{mode}
    %       \end{equation}


\clearpage

\section*{Appendix S3: Calculating uninformative and informative priors}

    To create Bayesian distributions for the probability of interactions, we must begin with a prior distribution. This distribution reflects our prior knowledge (or lack thereof) about the likelihood of a given interaction. Priors may be selected to be uninformative, so as not to bias the posterior distribution in any particular direction, or may be informative and based on some prior knowledge about the system.


    \subsection*{Uninformative prior}
      
        In the absence of any external information, an uninformative prior is the most conservative hypothesis for the distribution of $\lambda$. The beta distribution is in this case a uniform distribution, specified with hyper parameters $\alpha=1$ and $\beta=1$. 

    \subsection*{Distribution of connectance}
      
        The ecological network literature boasts a collection of networks for which connectance has been calculated and for which we can thus define the connectance distribution. Connectance is measured as $C = L/S^2$, where $L$ is the number of interactions and $S$ is the number of species. It measures the filling of an interaction matrix and thereby expresses the average probability that any two species interact with each other. If we know only the mean $\overline{C}$ and the variance $\sigma_C^2$ of the distribution of $C$, then the beta parameters could be computed as follows using the method of moments:

        \begin{equation}
        \alpha = \overline{C}(\frac{\overline{C}(1-\overline{C})}{\sigma_C^2}-1) ,
        \end{equation}

        \begin{equation}
        \beta = (1-\overline{C})(\frac{\overline{C}(1-\overline{C})}{\sigma_C^2}-1) .
        \end{equation}
  

    \subsection*{Degree distribution or interaction probabilities}

        The degree of a node in a network is defined as its number of connections to other nodes. The degree distribution of a network is then the probability distribution of these degrees over the whole network and the normalised degree (i.e., degree divided by the number of potential interaction partners) could therefore be interpreted as an interaction probability. It is consequently possible to use the degree distribution to inform the prior distribution. The degree distribution could come from several networks, from a similar network (e.g. a known network at slightly different location) or from the network of interest if interaction probabilities for some species are already documented. The latter approach allows researchers to apply information from known, abundant species to the rarest species for which interactions are less frequently documented. That is, we can use detection probabilities for interactions between abundant species to set bounds on detection probabilities for interactions involving rare species.


        If our focal network describes a system similar to that in a known network, we can use the distribution of interaction probabilities in that network to inform our prior. The probability of any interaction $L_{ij}$ depends on the degrees of species $i$ and $j$. Using normalised degrees $\Delta_i$ and $\Delta_j$, we can obtain the probability of interaction $L_{ij}$=$\Delta_i\times\Delta_j$. Similar to the procedure for degree distribution, the distribution of these interaction probabilities can be used to establish a prior distribution before any data from the focal network are collected. For distributions of either degrees or interaction probabilities, the procedure for the estimation of the hyper parameters follows the same approach as described above for connectance except that each measurement is at the individual interaction level instead of the network level.


    \subsection*{Trait-matching function} 

        As a fourth and final approach, it may be possible to obtain the prior distribution of $\lambda$ using the outcome of a trait-matching model, provided such a model has been parameterised using external data and relevant traits are available. In such a case, the prior distribution would follow the function $P(\lambda|\mathbf{T})=f(\mathbf{T})$ based on a set of traits for both species $\mathbf{T}$. There are several techniques available to perform this inference of interaction probability, some of which are Bayesian, and we refer interested readers to~\citet{Bartomeus2016} and~\citet{Weinstein2017} for recent reviews about this topic. Note that in this case the prior might not be beta-distributed and numerical methods might be required to compute the posterior distribution.  


        Trait-matching functions reduce uncertainty around the feasibility of interactions. Interactions between species with extremely mis-matched traits are very unlikely, and we can therefore be more confident that an unobserved interaction does not occur. This approach could be extended to models including environmental or phenological constraints, allowing researchers to reduce process uncertainty as well. Such models are, however, likely to be large and therefore may pose a risk of over-fitting.

    \subsection*{A quantitative example}

      The Bayesian framework can be illustrated with a simple quantitative example. Suppose we have $n = 10$ observations of co-occurrence between species $i$ and species $j$ in a given time interval and area, and $k = 3$ observations of interactions. The maximum likelihood estimate of the interaction probability is simply $\lambda_{MLE} = 3/10 = 0.3$. 
      

      Now consider we know that species $i$ is known to interact with 10 species (other than species $j$), which have the following degrees:

        \vspace{12pt}
        \noindent\emph{
          degree=c(14, 4, 2, 3, 17, 6, 2, 15, 1, 1)
            }.
          \vspace{12pt}

        If the network has 20 species total, this gives the normalised degrees:

        \vspace{12pt}
        \noindent\emph{
          norm\_degree=c(0.65, 0.20, 0.10, 0.15, 0.85, 0.30, 0.10, 0.75, 0.05, 0.05)}.
          \vspace{12pt}

        Species $i$ has a normalised degree of 0.55 (it interacts with species $j$ and 10 other species). We can combine the normalised degree of $i$ with the normalised degrees of its interaction partners to obtain the following set of interaction probabilities for species $i$ and each of its interaction partners:

        \vspace{12pt}
        \noindent\emph{
           int\_probs = c(0.358, 0.110, 0.055, 0.082, 0.468, 0.165, 0.055, 0.412, 0.028, 0.028) }.
          \vspace{12pt}

        The mean of these interaction probabilities is 0.176, approximately two-thirds the $\lambda_{MLE}$ obtained from the observed data. We can use the distribution of these interaction probabilities as our prior distribution and estimate the uncertainty surrounding our $\lambda_{MLE}$. With some simple R code (function ``calculate\_parameters", \emph{Appendix S7}), we obtain prior parameters $\alpha$=0.998 and $\beta$=4.63. Using these priors in equations~\ref{mean} and~\ref{variance} above (or in the R function ``calculate\_distribution" in \emph{Appendix S7}), we find a prior $\bar\lambda$=0.177 and var($\lambda$)=0.026. Adding the observed data ($n=10$, $k=3$) and using the same code, we obtain posterior parameters $\alpha'$=4.00 and $\beta'$=11.6 and a posterior $\bar\lambda$=0.256 and var($\lambda$)=0.012. Comparing the posterior distribution to the prior, we see that the posterior is closer to the observed data and that the additional data about interactions between species $i$ and $j$ has reduced the variance. We may also wish to calculate a credible interval (analogous to the frequentist confidence interval). This is also quite straightforward in R (see function ``credible\_interval" in \emph{Appendix S7}). In this case, a 95\% credible interval for $\bar\lambda$ is (0.080, 0.491).


        Now, consider the case where the two species have never been observed interacting across $n$ trials, i-e. $k=0$. The question is then ``what is the probability that these two species do not interact''? Since it is not possible to prove that the two species could never interact (strictly speaking, in a Bayesian approach $\lambda=0$ is impossible), we must fix a threshold below which we consider that there is no interaction ($\lambda \sim 0$). We call this threshold probability $\lambda*$. We then use the cumulative distribution function to estimate $P(\lambda<\lambda*|L=0,n)$ for different $n$. The function ``samples\_for\_threshold" in \emph{Appendix S7} calculates distribution function for $\lambda*$ with an increasing number of trials. This yields a surprising result: it requires \textgreater24 observations of no interactions to be 95\% sure that the interaction probability is smaller than $\lambda*$=0.1 (recall Fig.~\ref{upper_limits}, Box 2). Note the special case where there is no observation of the two species co-occurring, $n = 0$.  In this situation, the posterior distribution converges to the prior distribution since the data include no information on the probability with which species might interact should they co-occur.

\clearpage

\section*{Appendix S4: Details of \emph{Salix} data collection}

      The \emph{Salix}-galler-parasitoid meta-network dataset collected 
      by~\citet{Kopelke2017} consists of a single community type sampled across 
      Europe: willow (\emph{Salix}) species, willow-galling sawflies (Hymenoptera, Tenthredinidae, Nematinae, Euurina), and their natural 
      enemies (hymenopteran parasitoids and coleopteran, lepidopteran, dipteran, 
      and hymenopteran inquilines). The data were collected over 29 years 
      (1982-2010) at 374 unique locations across Europe ranging from Sicily to 
      the Arctic. Since the dataset includes repeated visits to a number of sites, the data set 
      contains 641 site-visits. Here we take the more conservative approach and pool visits to the same site for a sample size of 374 sub-networks.

      The meta-network consists of 1,173 different interactions 
      between 52 \emph{Salix} nodes, 92 herbivore nodes, and 126 parasitoid 
      nodes. Interactions were determined by dissecting and rearing gall 
      inhabitants from 165,424 galls. Some sites were visited repeatedly, for a 
      total of 641 site-visits. We consider these to be repeated samples and 
      take the 374 unique sites as our sample size.

\clearpage

\section*{Appendix S5: Results for \emph{Salix}-galler component}

    \subsection*{Computing the prior and posterior distributions}

      As with the galler-natural enemy component (presented in the main text), we estimated frequencies of \emph{Salix}-galler interactions based on the normalised degree of each species (\emph{Appendix S6}). We obtained prior parameters of $\alpha$=8.72, $\beta$=305 for the \emph{Salix}-galler component. These prior parameters were then used to estimate the posterior distribution. 


      For species where $n=0$ (3,986/4,992 \emph{Salix}-galler pairs in our dataset), estimates for the mean and variance of $\lambda_{ij}$ can be calculated directly from the prior distribution (\emph{Appendix S6}). For the \emph{Salix}-galler network, these parameters were: $\bar\lambda$=0.028, var($\lambda$)=8.60$\times$10$^{-5}$; note that this mean is much lower than that obtained using a prior based on~\citet[Data available from the Dryad Digital Repository: https://doi.org/10.5061/dryad.g7805]{Barbour2016}. Note that, despite the intensive sampling in the~\ref{Kopelke2017} dataset, most \emph{Salix}-galler pairs were never observed co-occurring (3,986/4,992; Fig.~\ref{histograms}).


      \begin{figure}[h!]
          \caption{\textbf{A)} Most pairs of \emph{Salix} and gallers were never observed co-occurring despite the high levels of replication in our example dataset. For those pairs that were observed together at least once ($n_{ij}>0$), the number of observed co-occurrences was generally small (\textless10). Here we show a histogram of the number of pairs of species observed co-occurring at least once. The 3986 \emph{Salix}-galler pairs never observed co-occurring are omitted from the histogram. \textbf{B)} Most pairs of species that were observed at the same site were never observed interacting. Here we show a histogram of the number of observed interactions within pairs of co-occurring species. Species which co-occurred but never interacted are included. \textbf{C)} Here we show, for each species pair, the number of observed interactions plotted against the number of observed co-occurrences. \emph{Salix}-galler pairs either are never observed interacting or interact almost every time they co-occur. The red, dashed line indicates a 1:1 relationship between interactions and co-occurrences.}
          \label{histograms}
          \begin{center}
          \includegraphics*[height=.7\textheight]{figures/SG_histogram.eps}
          \end{center}
          \end{figure}


      For species with $n>0$, the posterior distribution will depend on the values of $n$ and $k$. Here we are interested only in cases where $k = 0$. This gives $\alpha'$=$\alpha$ and $\beta'$=$\beta + n_{ij}$. For a pair of species which co-occurred at all 374 sites and was never observed to interact, the distribution for the \emph{Salix}-galler network would become $\bar\lambda_{ij}$=1.27 $\times$ 10$^{-2}$, var($\lambda_{ij}$)=1.82 $\times$ 10$^{-5}$. As $n$ decreases, the distribution widens and moves away from the origin (Fig.~\ref{Salix_pdfs}). The 95\% credible interval for hypothetical \emph{Salix}-galler pairs widened from (0.006, 0.022) if the pair co-occurred at all sites to (0.013, 0.049) if they co-occurred at none (Table~\ref{credints}). 

      \begin{figure}[h!]
        \caption{Using prior distributions based on the \emph{Salix}-galler network sampled at a single site in~\citet{Kopelke2017}, we can calculate posterior distributions for the probability of interaction ($\lambda$) between two species that have not yet been observed interacting. Here we show posterior distributions for $\lambda$ ranging from the prior distribution ($n=0$ observed co-occurrence) to the distribution obtained when the pair of species has been observed co-occurring 100 times. The distribution narrows and approaches zero as the sample size increases. Likewise, the maximum likelihood estimator for the mean probability of interaction (diamonds at top) approaches zero and the 95\% credible interval (lines at top) narrows as sample size increases. Dashed lines indicate threshold probabilities of 0.1, 0.05, and 0.01.}
        \label{Salix_pdfs}
        \begin{center}
        \includegraphics*[width=.9\textwidth]{figures/SG_pdfs_increasing_N_Zillis.eps}
        \end{center}
        \end{figure}


    \subsection*{How many samples are required to reach a minimal precision}

        In our dataset, the entire 95\% credible interval for the probability of an interaction between a \emph{Salix}-galler pair was (0.013, 0.049). We may therefore be 95\% confident that the interaction probability for \emph{Salix} and galler species that have not been observed co-occurring is below 0.05. As the peak of the prior distribution for the probability of interaction between \emph{Salix} and galler probabilities is around 0.02 (Fig.~\ref{Salix_pdfs}), to be 95\% confident that the interaction probability for these species is below 0.01 would require 1029 observed co-occurrences with no interaction - far more than the number of sites in the~\citep{Kopelke2017} dataset.


    \subsection*{Scaling up to network metrics}

      As with the galler-natural enemy component, we calculated posterior probability distributions for \emph{Salix}-galler pairs that were not observed interacting. For each posterior web, we calculated the connectance of each web, as well the mean links per \emph{Salix}, mean links per galler, and nestedness (NODF). Likewise, we created a suite of detection-filtered networks by randomly sampling 99\%, 95\%, 90\%, 80\%, 70\%, 60\%, and 50\% of the interactions included in each posterior network. We then calculated the same network properties as described above.


      We find, perhaps not surprisingly, that the posterior webs for the Salix-galler network  had higher connectances than the original, observed web (C=0.028 for the observed web and 0.082 $\leq$ C $\leq$ 0.096 for the posterior webs; Fig.~\ref{posterior_webs}A). The number of links per \emph{Salix} species in the observed web ($L_{\emph{Salix}}$=2.71) was similar to those in the posterior webs (2.53 $\leq L_{\emph{Salix}} \leq$ 3.19; Fig~\ref{posterior_webs}B). The number of links per galler, however, was lower in the observed web ($L_{galler}$=1.47) than in the posterior webs, accounting for the increased connectance (4.67 $\leq L_{galler} \leq$ 5.88; Fig.~\ref{posterior_webs}D). There was a more substantial difference in the nestedness of the observed and posterior webs: the observed network had NODF=0.560 while the posterior networks were more nested (1.39 $\leq NODF \leq$ 1.94). Even the networks sampled with a detection filter of 50\% had non-zero nestedness (Fig.~\ref{posterior_webs}C). This last result highlights the potential for the possibility for network structure to vary when considering the possibility that unobserved species pairs may interact.


    \begin{figure}[h!]
      \caption{Here we show the mean connectance, links per resource (\emph{Salix} in the \emph{Salix}-galler networks and gallers in the galler-natural enemy networks), links per consumer, and nestedness (NODF) for networks assembled using posterior distributions based on a single sub-network in the~\citet{Kopelke2017} dataset (Zillis). We created 100 ``posterior-sampling" networks and then, for each of these, created 100 ``detection-filter" networks by randomly sampling 50\%-99\% of the interactions included in the posterior-sampling network. This simulates imperfect detection of interactions in the field. Each point represents the mean network property (e.g., connectance) obtained from a set of 100 detection-filter networks, plotted against the value of the network property in the posterior-sampling network used to create the detection-filter networks. For each property and both network types, the posterior-sampling networks cover a relatively small range of network properties than the range covered by networks with varying detection probabilities. The value of each property decreases with the proportion of links included in the detection-filter networks.}
      \label{posterior_webs}    
      \begin{center}
      \includegraphics[width=.9\textwidth]{figures/SG_posterior_properties_Zillis.eps}
      \end{center}
      \end{figure}

\clearpage

\section*{Appendix S6: Analyses using alternative prior}

  We repeated our analyses using an alternative prior derived from a study of a similar \emph{Salix}-galler-natural enemy system in North America~\citep{Barbour2016,Barbour2016Dryad}. We note that this study used several genotypes of \emph{Salix hookeriana} rather than different \emph{Salix} species and so did not produce networks of similar size and connectedness to those in~\citep{Kopelke2017}.  To obtain the priors based on~\citet{Barbour2016}, we estimated frequencies of  \emph{S. hookeriana} genotype-galler interactions based on the normalised degree of each node (species or genotype) in each network component.

    \subsection*{Creating a binary interaction network}

      \citet{Barbour2016,Barbour2016Dryad} sampled 145 branches from 
      \emph{Salix hookeriana} of 26 genotypes. They recorded galls 
      made by four species of Cecidomyid midges on each branch. We 
      transformed these data to a binary genotype-galler network 
      matrix, where an entry $ij$ was 1 if galler $i$ was observed 
      on any branch of genotype $j$ and 0 otherwise. In total, this 
      network contained 75 realised galler-genotype interactions 
      out of a potential 104. One \emph{S. hookeriana} genotype did
      not interact with any gallers and was removed from the network.
      The R code used to extract this 
      network follows:


      \vspace{12pt}
      \begin{em}
      \noindent \hspace{2pt}prior\_web\_data=read.csv(``tree\_level\_interaxn\_all\_plants\_traits\_size.csv")\\
      \vspace{4pt}
      \noindent \hspace{2pt}\# Remove extra data on parasitoids, etc.\\
      \noindent \hspace{2pt}prior\_web\_data[,31:57]\textless-NULL\\
      \noindent \hspace{2pt}prior\_web\_data[,4:26]\textless-NULL\\
      \noindent \hspace{2pt}prior\_web\_data[,2]\textless-NULL\\
      \vspace{4pt}
      \noindent \hspace{2pt}\# Build a web with interactions=1 for any galler observed on any genotype\\
      \noindent \hspace{2pt}prior\_web=matrix(nrow=26,ncol=4)\\
      \noindent \hspace{2pt}for(r in 1:length(levels(prior\_web\_data\$Genotype)))\{\\
      \hspace{4pt}gen=levels(prior\_web\_data\$Genotype)[r]\\
      \hspace{4pt}subset=prior\_web\_data[which(prior\_web\_data\$Genotype==gen),]\\
      \hspace{4pt}for(c in 1:4)\{\\
      \hspace{8pt}if(sum(subset[,2+c])\textgreater0)\{\\
      \hspace{12pt}prior\_web[r,c]=1\\
      \hspace{8pt}\} else \{\\
      \hspace{12pt}prior\_web[r,c]=0\\
      \hspace{8pt}\}\}\}\\
      \vspace{4pt}
      \noindent \hspace{2pt}\# Remove non-interactive genotype to obtain the final web\\
      \noindent \hspace{2pt}prior\_web\textless-prior\_web[which(rowSums(prior\_web)\textgreater0),]
      \end{em}

      % prior_web_data=read.csv('../../data/Salix_example/tree_level_interaxn_all_plants_traits_size.csv')
      % # Remove extra data on parasitoids, etc.
      % prior_web_data[,31:57]<-NULL
      % prior_web_data[,4:26]<-NULL
      % prior_web_data[,2]<-NULL
      % # Build a web with interactions=1 for any galler observed on any genotype
      % prior_web=matrix(nrow=26,ncol=4)
      % for(r in 1:length(levels(prior_web_data$Genotype))){
      %   gen=levels(prior_web_data$Genotype)[r]
      %   subset=prior_web_data[which(prior_web_data$Genotype==gen),]
      %   for(c in 1:4){
      %     if(sum(subset[,2+c])>0){
      %       prior_web[r,c]=1
      %     } else {
      %       prior_web[r,c]=0
      %     }
      %   }        
      % }
      % prior_web<-prior_web[which(rowSums(prior_web)>0),]
      % write.csv(prior_web,file='binary_prior_web_SG.csv',quote=F)

      \vspace{12pt}
      \clearpage

      To extract the galler-parasitoid network from the same study above:


      \vspace{12pt}
      \begin{em}
      \noindent \hspace{2pt}prior\_web\_data=read.csv(``tree\_level\_interaxn\_all\_plants\_traits\_size.csv")\\
      \noindent \hspace{2pt}prior\_web\_data \textless- prior\_web\_data[,8:26]\\
      \vspace{4pt}
      \noindent \hspace{2pt}\# Build a web with interactions=1 for any parasitoid on any galler\\
      \noindent \hspace{2pt}prior\_web=data.frame()\\
      \vspace{4pt}
      \noindent \hspace{2pt}\# each column contains all interactions for a \noindent \hspace{2pt}particular parasitoid-galler combination\\
      \noindent \hspace{2pt}for(column in 1:ncol(prior\_web\_data))\{\\
      \hspace{4pt}\# the column name gives the species which makes the gall,\\
      \hspace{4pt}\#followed by the species emerging from the gall\\
      \hspace{4pt}galler\_emerged=strsplit(colnames(prior\_web\_data)[column], "\_")\\
      \hspace{4pt}galler = galler\_emerged[[1]][1]\\
      \hspace{4pt}emerged = galler\_emerged[[1]][2]\\
      \vspace{4pt}
      \hspace{4pt}\# the strength of the interaction is the sum of the column\\
      \hspace{4pt}(number of galls across all branches sampled)\\
      \hspace{4pt}linkstrength = sum(prior\_web\_data[,column])\\
      \hspace{4pt}prior\_web[as.character(galler),as.character(emerged)] \textless- linkstrength\\
      \}\\
      \vspace{4pt}
      \noindent \hspace{2pt}\# Make the NAs into 0\\
      \noindent \hspace{2pt}prior\_web[is.na(prior\_web)] \textless- 0\\
      \vspace{4pt}
      \noindent \hspace{2pt}\# remove emerging gallers with no parasitoids\\
      \noindent \hspace{2pt}prior\_web\_para\_only \textless- prior\_web[,c(2:6,8:9,12)]\\
      \vspace{4pt}
      \noindent \hspace{2pt}\# convert interaction strengths to 1\\
      \noindent \hspace{2pt}prior\_web[which(prior\_web\textgreater0)] \textless- 1\\
      \noindent \hspace{2pt}write.csv(prior\_web\_para\_only, file=``prior\_web\_para\_only.csv", quote=F)\\
      \end{em}

      % % # read in the data
      % prior_web_data=read.csv('../../data/Salix_example/tree_level_interaxn_all_plants_traits_size.csv')
      % # just keep what we need
      % prior_web_data <- prior_web_data[,8:26]

      % # Build a web with interactions=1 for any parasitoid on any galler
      % prior_web=data.frame()

      % # each column contains all interactions for a particular parasitoid-galler combination
      % for(column in 1:ncol(prior_web_data)){
      %   # the column name gives the species which makes the gall, followed by the species emerging from the gall
      %   # they need to be separated 
      %   galler_emerged=strsplit(colnames(prior_web_data)[column], "_")
      %   galler = galler_emerged[[1]][1]
      %   emerged = galler_emerged[[1]][2]
        
      %   # the strength of the interaction is the sum of the column (number of galls across all branches sampled)
      %   linkstrength = sum(prior_web_data[,column])
      %   # put that into a dataframe
      %   prior_web[as.character(galler),as.character(emerged)] <- linkstrength
      % } 

      % # Make the naS into 0
      % prior_web[is.na(prior_web)] <- 0
      % # Make the non-zero elements into 1
      % prior_web[prior_web>0] <- 1
      % # some of the emergers were the gallers, remove those columns if we're only
      % # interested in galler-parasitoid interactions
      % prior_web_para_only <- prior_web[,c(2:6,8:9,12)]
      % write.csv(prior_web_para_only, file="binary_prior_web_para_only.csv", quote=F)

      \clearpage


    \subsection*{Prior and posterior distributions}

      Using the binary networks described above, we obtained prior parameters $\alpha$=2.51 and $\beta$=1.89 for the \emph{Salix}-galler component and $\alpha$=1.34, $\beta$=9.49 for the galler-natural enemy component of the network. We then calculated prior distributions using these parameters. For the \emph{Salix}-galler network, the prior distribution was: $\bar\lambda$=0.570, var($\lambda$)=0.056. The prior distribution for the galler-natural enemy network was: $\bar\lambda$=0.124, var($\lambda$)=0.010. As with the results in the main text, we can update this prior distribution using observed co-occurrences. In the most extreme case where a pair of species co-occurred at all 374 sites and was never observed interacting, our distributions would become 
      $\bar\lambda_{ij}$=6.63 $\times$ 10$^{-3}$, var($\lambda_{ij}$)=1.74 $\times$ 10$^{-5}$ for the \emph{Salix}-galler network and 
      $\bar\lambda_{ij}$=3.49 $\times$ 10$^{-3}$, var($\lambda_{ij}$)=9.03 $\times$ 10$^{-6}$ for the galler-natural enemy network. 

    \subsection*{Credible intervals and sampling requirements}

      The 95\% credible intervals calculated using the priors derived from~\citet{Barbour2016} were much wider than those reported in the main text (Fig.~\ref{Salix_pdfs}). For hypothetical \emph{Salix}-galler and galler-natural enemy pairs these intervals widened from (0.001, 0.017) and (\textless0.001, 0.11) for pairs observed co-occurring at all 374 sites without any observed interaction to (0.152,0.931) and (0.008, 0.364) for \emph{Salix}-galler and galler-natural enemy pairs that were never observed co-occurring.


      \begin{figure}[h!]
        \caption{Using prior distribution based on the \emph{Salix}-galler and galler-natural enemy networks in~\citet{Barbour2016}, we can calculate posterior distributions for the probability of interaction ($\lambda$) between two species that have not yet been observed interacting. Here we show posterior distributions for each $\lambda$ in each network ranging from the prior distribution ($n=0$ observed co-occurrence) to the distribution obtained when the pair of species has been observed co-occurring 100 times. The distribution narrows and approaches zero as the sample size increases. Likewise, the maximum likelihood estimator for the mean probability of interaction (diamonds at top of each panel) approaches zero and the 95\% credible interval (lines at top of each panel) narrows as sample size increases. \textbf{A)} The posterior distributions for the \emph{Salix}-galler component are always wider and farther from zero than those for \textbf{B)} the galler-natural enemy component. This is likely because the prior distribution for the galler-natural enemy component of the network was both narrower and had a mean closer to that in the~\citet{Kopelke2017} data than did the \emph{Salix}-galler component.}
        \label{Salix_pdfs}
        \begin{center}
        \includegraphics*[width=.65\textwidth]{figures/Salix_Galler_pdfs_increasing_N.eps}
        \end{center}
        \end{figure}


      If we want to be 95\% confident that the interaction probability for two species in the \emph{Salix}-galler network is below 0.1, 0.05, or 0.01, we would need 51, 106, and 550 observed co-occurrences with no observed interaction, respectively (Fig.~\ref{Salix_cdfs}). The number of samples required to be 95\% confident that the interaction probability between galler and natural enemy species is below a threshold also increases quickly as the threshold decreases; we would need 25, 62, and 352 observed co-occurrence with no observed interaction for threshold interaction probabilities of 0.1, 0.05, and 0.01, respectively. 


      \begin{figure}[h!]
        \caption{The number of samples required to achieve a given level of confidence that an interaction probability $\lambda_{ij}$ is below a given threshold varies with both parameters. With a low threshold, our confidence that $\lambda_{ij}$ is below the threshold increases rapidly with repeated observation of co-occurrence without interaction. Here we show the cumulative density functions for threshold probabilities of 0.5 (solid line), 0.25 (dashed line), 0.1 (dash-dot line), and 0.05 (dotted line) as well as the points at which the cdf reaches 0.90 (orange square), 0.95 (red circle), and 0.975 (blue diamond) for each threshold value. The large ticks along the x-axis indicate the number of samples associated with each of these points. Note that the number of samples required to reach any given threshold is larger for \textbf{A)} the \emph{Salix}-galler network than for \textbf{B)} the galler-natural enemy network. In the galler-natural enemy network, the credible interval for a pair of species with no observed co-occurrences was 0.364. All pairs of species therefore have $\lambda$\textless0.5.}
        \label{Salix_cdfs}
        \begin{center}
        \includegraphics[width=.65\textwidth]{figures/Salix_Galler_samples_and_cdfs.eps}
        \end{center}
        \end{figure}


    \subsection*{Scaling up to network metrics}


      We find, perhaps not surprisingly, that the posterior webs for the Salix-galler network all had much higher connectance than the original, observed web (C=0.028 for the observed web and 0.528 $\leq$ C $\leq$ 0.568 for the posterior webs; Fig.~\ref{posterior_webs}A). Likewise, the number of links per \emph{Salix} and galler species in the observed web ($L_{\emph{Salix}}$=2.71 and $L_{galler}$=1.47, respectively) were much lower than those predicted in the posterior webs (27.4 $\leq L_{\emph{Salix}} \leq$ 29.5 and 50.6 $\leq L_{galler} \leq $54.5, respectively; Fig.~\ref{posterior_webs}C,E), even when filtering with a detection probability of only 50\%. Nestedness was also much higher in the posterior networks (14.2 $\leq NODF \leq$ 15.4; Fig.~\ref{posterior_webs}G) than in the observed network (NODF=0.560). There are two possible explanations for these discrepancies: either the data of~\citet{Barbour2016} is simply too different from that of~\citet{Kopelke2017} to offer an appropriate prior for our dataset, or the true detection probability for links between \emph{Salix} and galler species is much less than 50\%. As the scale of the two datasets is quite different (genotypes of a single \emph{Salix} species in~\citet{Barbour2016}, various \emph{Salix} species in our dataset), we suspect the former is more likely.


      Considering the galler-natural enemy networks, the connectance, mean links per galler, and mean links per natural enemy were also much lower in the observed web (C=0.078, $L_{galler}$=9.99, and $L_{natural enemy}$=7.45, respectively) than in the posterior webs (0.183 $\leq$ C $\leq$ 0.196, 17.5 $\leq L_{galler} \leq$ 18.9, and 23.0 $\leq L_{natural enemy} \leq$ 24.8). When the detection probability was relatively low (i.e., 50\%), however, the properties of randomised networks became similar to those in the observed webs (Fig.~\ref{posterior_webs}B,D,F). Nestedness was higher in the observed network (NODF=6.85) than in the posterior networks (6.30 $\leq NODF \leq$ 6.74; Fig.~\ref{posterior_webs}H), but network structure was much more similar in the observed and posterior galler-natural enemy networks than in the \emph{Salix}-galler networks. The~\citet{Barbour2016} network likely provides a better prior here than for the \emph{Salix}-galler networks, as both networks included different galler and natural enemy species. Although the two networks differ vastly in scale, and the inclusion of multiple \emph{Salix} species likely causes structural differences from~\citet{Barbour2016} despite the similar resolution of gallers and natural enemies, this result nevertheless suggests that even such a large and well-replicated network as that in~\citet{Kopelke2017} is missing many interactions. This should be a strong warning to researchers comparing structural characteristics between networks - small structural differences are likely to be masked by substantial noise resulting from sampling uncertainty.



      \begin{figure}[ht]
      \caption{Here we show the mean connectance, links per resource (\emph{Salix} in the \emph{Salix}-galler networks and gallers in the galler-natural enemy networks), links per consumer, and nestedness (NODF) for networks assembled using posterior distributions based on a smaller, North American \emph{Salix}-galler-natural enemy system~\citep{Barbour2016,Barbour2016Dryad}. We created 100 ``posterior-sampling" networks and then, for each of these, created 100 ``detection-filter" networks by randomly sampling 50\%-99\% of the interactions included in the posterior-sampling network. This simulates imperfect detection of interactions in the field. Each point represents the mean network property (e.g., connectance) obtained from a set of 100 detection-filter networks, plotted against the value of the network property in the posterior-sampling network used to create the detection-filter networks. For each property and both network types, the posterior-sampling networks cover a relatively small range of network properties than the range covered by networks with varying detection probabilities. The value of each property decreases with the proportion of links included in the detection-filter networks.}
      \label{posterior_webs}    
      \begin{center}
      \includegraphics[width=.65\textwidth]{Figures/Salix_Galler_posterior_properties.eps}
      \end{center}
      \end{figure}

\clearpage

\section*{Appendix S7: Obtaining prior interaction probabilities}

    \subsection*{Degree distributions and interaction probabilities}

      Obtaining degree distributions from the binary interaction 
      network is straightforward. To do this, we simply divide the 
      total number of observed interaction partners for each 
      species (row or column sums) with the number of potential 
      interaction partners (number of column or rows). Degree 
      distributions calculated, we can then calculate the 
      probability of each interaction as the product of the 
      normalised degrees of the two species. For example, the 
      probability of an interaction between two species with 
      normalised degrees of 0.5 (each interacts with half of the 
      available partners) is 0.25. R code used to do this follows:


      \vspace{12pt}
      \begin{em}
      \noindent \hspace{2pt}\# Now get the degree distributions from the web\\
      \noindent \hspace{2pt}deg\_dist\_Salix=rowSums(prior\_web)/ncol(prior\_web)\\
      \vspace{4pt}
      \noindent \hspace{2pt}\# Remove one genotype that never interacted\\
      \noindent \hspace{2pt}deg\_dist\_Salix\textless-deg\_dist\_Salix[which(rowSums(prior\_web)\textgreater0)]\\
      \noindent \hspace{2pt}deg\_dist\_galler=colSums(prior\_web)/nrow(prior\_web)\\
      \vspace{4pt}
      \noindent \hspace{2pt}\# Interaction probabilities are the product of plant and galler probabilities\\
      \noindent \hspace{2pt}int\_probs=as.numeric(deg\_dist\_galler\%$*$\%t(deg\_dist\_Salix))\\
      \vspace{4pt}
      \noindent \hspace{2pt}\# And for the galler-parasitoid web:\\
      \noindent \hspace{2pt}deg\_dist\_parasitoid=rowSums(prior\_web\_para\_only)/ncol(prior\_web\_para\_only)\\
      \noindent \hspace{2pt}deg\_dist\_parasitised=colSums(prior\_web\_para\_only)/nrow(prior\_web\_para\_only)\\
      \noindent \hspace{2pt}gp\_int\_probs=as.numeric(deg\_dist\_parasitised\%$*$\%t(deg\_dist\_parasitoid))\\
      \end{em}


      % SG_web=read.csv('binary_prior_web_SG.csv',row.names=1)
      % GP_web=read.csv('binary_prior_web_para_only.csv',row.names=1)

      %       # Now get the degree distributions from the web
      % deg_dist_Salix=rowSums(SG_web)/ncol(SG_web)
      % deg_dist_galler=colSums(SG_web)/nrow(SG_web)
      % # Interaction probabilities are the product of plant and galler probabilities
      % sg_int_probs=as.numeric(deg_dist_galler%*%t(deg_dist_Salix))

      % deg_dist_parasitoid=rowSums(GP_web)/ncol(GP_web)
      % deg_dist_parasitised=colSums(GP_web)/nrow(GP_web)
      % gp_int_probs=as.numeric(deg_dist_parasitised%*%t(deg_dist_parasitoid))

\clearpage

\section*{Appendix S8: R code for calculating posterior distributions and confidence intervals}

  The following simple functions are implemented in the R language. They are 
  also provided as R code in a separate file.
  Priordata is the list of interaction frequencies from the prior 
  data, $n$ is the number of sites with observed co-occurrence of 
  species $i$ and $j$, and $k$ is the number of sites with an 
  observed interaction $ij$. When calculating the prior 
  distribution, both $n$ and $k$ are 0. In the main text we assume 100\%
  confidence in observed interactions and therefore consider only 
  cases where $k$=0. Only $n$ varies between species pairs.


  To calculate the parameters $\alpha$ and $\beta$ of a prior or 
  posterior distribution:

  \vspace{12pt}
  \begin{em}
  \noindent \hspace{2pt}calculate\_parameters\textless-function(priordata,n,k)\{\\
  \vspace{4pt}
    \# Calculate prior parameters\\
    start=list(shape1=1,shape2=1)\\
    pars=fitdistr(x=priordata,`beta',start=start,lower=c(0,0))\$estimate\\
    alpha=pars[[1]]\\
    beta=pars[[2]]\\
  \vspace{4pt}
    \# Update the parameters with data. If n=0 and k=0, no change.\\
    alpha\_prime=alpha+k\\
    beta\_prime=beta+n-k\\
    pars2=c(alpha\_prime,beta\_prime)\\
    return(pars2) \}
  \end{em}
  \vspace{12pt}


    All of the following functions use the parameters returned by 
    ``calculate\_parameters". To calculate the maximum likelihood estimates of 
    the mean and variance of the probability of interaction $\lambda_{ij}$:

    \vspace{12pt}
    \begin{em}
    \noindent \hspace{2pt}calculate\_distribution\textless-function(pars)\{\\
     \vspace{4pt}
     \# alpha and beta may be from a prior or posterior distribution\\
      alpha=pars[[1]]\\
      beta=pars[[2]]\\
      \vspace{4pt}
      \# Calculate the MLE of the mean\\
      mu\_numerator=alpha\\
      mu\_denominator=alpha+beta\\
      mu=mu\_numerator/mu\_denominator\\
      \vspace{4pt}
      \# Calculate the MLE of the variance\\
      sig\_numerator=alpha\*beta\\
      den1=alpha+beta\\
      den2=den1$**$2\\
      sig\_denominator=den1$*$den2\\
      sigma2=sig\_numerator/sig\_denominator\\
      return(c(mu,sigma2))\}
    \end{em}
  \vspace{12pt}
      
  \clearpage

  To calculate a credible interval based on the prior or posterior distribution, for given lower and upper bounds:


  \vspace{12pt}
  \begin{em}
  \noindent \hspace{2pt}credible\_interval\textless-function(pars,p\_lower,p\_upper)\{\\
    \vspace{4pt}
    alpha=pars[[1]]\\
    beta=pars[[2]]\\
    lowCI=qbeta(p=p\_lower,shape1=alpha,shape2=beta)\\
    highCI=qbeta(p=p\_upper,shape1=alpha,shape2=beta)\\
    return(c(lowCI,highCI))\}
  \end{em}
  \vspace{12pt}

  To calculate the number of samples required to reach a given level of confidence that the probability of interaction between two species ($\lambda_{ij}$) that have not been observed co-occurring is below a threshold value:


  \vspace{12pt}
  \begin{em}
  \noindent \hspace{2pt}samples\_for\_threshold\textless-function(threshold,confidence,pars)\{\\
    \vspace{4pt}
    alpha=pars[[1]]\\
    beta=pars[[2]]\\
    n=seq(0,100,1)\\
    k=0\\ 
    cdf=pbeta(threshold,shape1=alpha,shape2=beta+n)\\
    samples=length(which(cdf\textless confidence))\\
    return(samples) \}
  \end{em}

\clearpage

\section*{Appendix S9: Calculating the credible interval around a probability estimate}

  Here we describe the derivation of the Clopper-Pearson credible interval for the estimated probability of interaction $\lambda$ of a pair of species observed co-occurring $n$ times and interacting $k$ times. As we are most interested in the probability of interaction between species pairs that have never been observed co-occurring, we consider only the case where $k=0$ over a variety of $n$. This is straightforward to do in R (see the function ``credible\_interval" in \emph{Appendix S7}). 


  First, we must obtain the $\alpha$ and $\beta$ parameters for the prior distribution. In this study we obtained these parameters using the R~\citep{R} function fitdist from the package fitdistrplus~\citep{fitdistrplus}. Once $\alpha$ and $\beta$ are known, we can update them using our observed data. Specifically, we are interested in $\alpha'=\alpha+k$ and $\beta'=\beta+n-k$. These parameters can then be used to calculate a credible interval using the R~\citep{R} function qbeta. In the table below, we present the 95\% credible intervals for \emph{Salix}-galler and galler-natural enemy pairs with different numbers of observed co-occurrences ($n$) and no observed interactions ($k=0$), calculated using prior information derived from the Zillis sub-network~\citep{Kopelke2017}.

      % % # R code to make the table:
      % ns=c(0,1,2,5,10,15,20,25,50,100,150,200,374)
      % output=matrix(nrow=length(ns),ncol=5)
      % output[,1]=ns
      % for(r in 1:nrow(output)){
      %   interval1=credible_interval(calculate_parameters(sg_int_probs,ns[r],0),0.025,0.975)    
      %   interval2=credible_interval(calculate_parameters(gp_int_probs,ns[r],0),0.025,0.975)    
      %   output[r,2:3]=interval1
      %   output[r,4:5]=interval2
      % }
      \medskip
      \begin{table}
        \label{credints}
        \caption{Here we give the lower and upper bounds of 95\% credible intervals for the probability of interaction $\lambda$ between \emph{Salix}-galler or galler-natural enemy pairs that have been observed co-occurring $n$ times but have never been observed interacting.}
        \begin{tabular}{l  c c  c c }
        \multirow{2}{*}{$n$} & \multicolumn{2}{c}{\emph{Salix}-galler} & \multicolumn{2}{c}{galler-natural enemy}\\
         & Lower bound & Upper bound & Lower bound & Upper bound \\
        \hline
        0   & 0.013 & 0.049 & 5.39 $\times10^{-4}$ & 0.304 \\
        1   & 0.013 & 0.048 & 4.82 $\times10^{-4}$ & 0.276 \\
        2   & 0.013 & 0.048 & 4.35 $\times10^{-4}$ & 0.253 \\
        5   & 0.012 & 0.048 & 3.37 $\times10^{-4}$ & 0.203 \\
        10  & 0.012 & 0.047 & 2.45 $\times10^{-4}$ & 0.152 \\
        15  & 0.012 & 0.046 & 1.93 $\times10^{-4}$ & 0.121 \\
        20  & 0.012 & 0.046 & 1.59 $\times10^{-4}$ & 0.101 \\
        25  & 0.012 & 0.045 & 1.35 $\times10^{-4}$ & 0.087 \\
        50  & 0.011 & 0.042 & 7.72 $\times10^{-5}$ & 0.050 \\
        100 & 0.010 & 0.037 & 4.16 $\times10^{-5}$ & 0.027 \\
        150 & 0.009 & 0.033 & 2.84 $\times10^{-5}$ & 0.019 \\
        200 & 0.008 & 0.030 & 2.16 $\times10^{-5}$ & 0.014 \\
        \hline
        374 & 0.006 & 0.022 & 1.18 $\times10^{-5}$ & 0.008 \\
        \hline
        \end{tabular}
      \end{table}

\clearpage

  \bibliographystyle{ecol_let} 
  \bibliography{manual_abbrev}

\end{document}


