\documentclass[12pt]{article}
\usepackage{amsmath} 
\usepackage[dvips]{graphicx}
\usepackage{multirow} 
\usepackage{geometry} 
\usepackage{pdflscape}
\usepackage[labelfont=bf]{caption} 
\usepackage{setspace}
\usepackage[running]{lineno} 
% \usepackage[numbers,sort]{natbib}
\usepackage[round]{natbib} 
\usepackage{array}
\usepackage{hyperref}
\usepackage{float}
\makeatletter


% this creates a custom and simpler ruled box style
\newcommand\floatc@simplerule[2]{{\@fs@cfont #1 #2}\par}
\newcommand\fs@simplerule{\def\@fs@cfont{\bfseries}\let\@fs@capt\floatc@simplerule
  \def\@fs@pre{\hrule height.8pt depth0pt \kern4pt}%
  \def\@fs@post{\kern4pt\hrule height.8pt depth0pt \kern4pt \relax}%
  \def\@fs@mid{\kern8pt}%
  \let\@fs@iftopcapt\iftrue}

% this code block defines the new and custom floatbox float environment
\floatstyle{simplerule}
\newfloat{floatbox}{thp}{lob}
\floatname{floatbox}{Box}

\newcommand{\methods}{\textit{Materials \& Methods}}
\newcommand{\SI}{\textit{Appendix}~}

\topmargin -1.5cm % 0.0cm 
\oddsidemargin 0.0cm % 0.2cm 
\textwidth 6.5in
\textheight 9.0in % 21cm
\footskip 1.0cm % 1.0cm

\usepackage{authblk}

\title{???A quantitative framework for investigating the reliability of network construction}


\author{Alyssa R. Cirtwill$^{1}$, Dominique Gravel, \&  Anna Ekl\"{o}f$^{1}$, Tomas Roslin$^{x,y}$, Kate Wootton$^{x}$}
\date{\small$^1$Department of Physics, Chemistry\\ 
and Biology (IFM)\\ 
Link\"{o}ping University\\
Link\"{o}ping, Sweden\\
\medskip $^x$ Department of Ecology\\ P.O. Box 7044, Swedish University of Agricultural Sciences \\ SE-750 07 Uppsala, Sweden \\
\medskip $^y$ Spatial Foodweb Ecology Group\\ Department of Agricultural Sciences \\ PO Box 27 (Latokartanonkaari 5)\\ FI-00014 University of Helsinki, Finland \\
% \medskip
% $^\dagger$ Corresponding author:\\
% alyssa.cirtwill@gmail.com\\
% +46 723 158464\\
}

\renewcommand\Authands{ and }

\begin{document} 
\maketitle 
\raggedright
\setlength{\parindent}{15pt} 


\section*{Abstract}



\section*{Introduction}

    Representation of a species assemblage as a network offers a convenient summary of how the community is constructed as it simultaneously accounts for species composition and their interactions. A tabulation of the nodes (species) and of their relative abundances forms the basis for traditional metrics of community composition. On top of this information, interactions are represented by links between nodes so that networks provide additional, higher-order information on community structure. Empirical descriptions of ecological networks are, however, usually considered to be static representations of the communities and interactions they describe. This approach contrasts significantly with the widely recognized stochasticity of ecological communities \citep{Gotelli2000}. That is, whether the network is assembled based on aggregated data, a single intensive ``snapshot" sample, or expert knowledge, interactions are assumed to occur deterministically wherever and whenever the community is observed~\citep{Olesen2011a}. 


    The assumption of static communities conflicts with known variation in both  the nodes and links included in a network. Community composition and species abundances vary from site to site~\citep{Baiser2012} and over time within a site~\citep{Olesen2011a}. Likewise, interactions over space~\citep{Kitching1987,Baiser2012}, time~\citep{Kitching1987,Olesen2011a}, and between individuals of a given species~\citep{Pires2011a,Fodrie2015,Novak2015}. Moreover, variability in community composition and interactions may or may not be closely related. The removal of a species from a site will obviously also remove its interactions, but the co-occurrence of potentially interacting species do not guarantee they will interact at a given place and time. Interactions can be lost, or not detected, if participating species remain present but do not co-occur temporally, are too rare to detect each other~\citep{Tylianakis2010}, because of environmental contingencies \citep{Poisot2015a}, or through changes to individual preferences~\citep{Fodrie2015}. 

    Beyond ``true" variation in network structure, several researchers have pointed to the importance of sampling intensity for the assessment of network structure (e.g.,~\citealp{Martinez1999,Bluthgen2006,XX}). Accumulation of interactions with increasing sampling effort suggests that it is even more challenging to document interactions than species richness \citep{Poisot2012}. As a result, it was proposed that interactions should be described probabilistically and network metrics computed accordingly \citep{Poisot2015b}. Despite this, the acknowledgment that insufficient sampling effort limits our ability to describe variation in ecological networks has not yet led to a quantitative methodology to deal with the uncertainty generated by spatiotemporal variation in ecological interactions and by sampling. Moreover, even in extremely well-sampled networks uneven sampling across species (or pairs of species) can lead to the assumption that some species do not interact because they co-occur rarely or have not yet been observed co-occuring (see Box 1). It is therefore likely that nearly all network studies are missing some interactions and could benefit from an approach that acknowledges this uncertainty.



\begin{floatbox}{}

  We have lots and lots of data, but still not enough for almost all pairs of species.   
% DG : I wonder if a paragraph summarizing the extent of the problem with the salix data should not be provided here. Either within the text, or a box. But we need to convingly show how large is this problem even for such an extensive dataset
% AC : I like the box idea. Since we refer to the Salix data throughout the manuscript it makes sense to make it stand out. 
    
    As a case study, we use an extensively sampled \emph{Salix}-galler-parasitoid meta-network. This dataset consists of a single community type sampled across Europe; willow (\emph{Salix}) species, willow-galling sawflies, and their natural enemies. The data were collected over 29 years at 374 unique locations across Europe, with a total of 641 site visits. Each site visit can be considered as a network in its own right and an independent sample from which to build the meta-network. The meta-network consists of 1,173 different interactions between 52 \emph{Salix} nodes, 92 herbivore nodes, and 126 natural enemy nodes. The high spatiotemporal resolution of this network and the unusually high sampling effort implemented at the site level makes this dataset particularly well suited for illustrating the difficulties in completely sampling a network and testing Bayesian approaches to overcome these difficulties.


    We may begin by comparing the frequency of of co-occurence of taxa to reveal the challenge of having sufficient sampling to be confident that an interaction does not occur (Fig.~\ref{upper_limits}). Most pairs of species (3986/4992 \emph{Salix}-galler pairs and  9794/12096 galler-natural enemy pairs) are never found co-occurring, and for species that did occur the number of co-occurrences was generally low (mean=4.24, var=36.3 for \emph{Salix}-galler pairs; mean=3.87, var=28.8 for galler-natural enemy pairs; Fig.~\ref{histograms}A-B). For those species which interacted when co-occurring, the incidence of interaction was also low (mean=12.0, var=155 for \emph{Salix}-galler pairs; mean=4.04, var=29.3 for galler-natural enemy pairs; Fig.~\ref{histograms}C-D). Only 2.82\% of \emph{Salix}-galler pairs and 7.76\% of galler-natural enemy pairs were observed interacting at all. Thus, even in the most extensive data set that we could find, limited sampling is clearly a major source of uncertainty.

  \caption{\emph{Salix} dataset}
  \label{box1}
\end{floatbox}

%DG: be careful : occurrence, not occurance on the figures
    \begin{figure}
      \caption{\textbf{A-B)} Most pairs of \emph{Salix} and galler or galler and parasitoid species were never observed co-occurring despite the high levels of replication in our example dataset. For those pairs that were observed together at least once ($n_{ij}>0$), the number of observed co-occurrences was generally small (\textless10). Here we show a histogram of the number of pairs of species observed co-occurring at least once. 3986 pairs of species were never observed co-occurring: these pairs are omitted from the histogram. \textbf{C-D)} Most pairs of species that were observed at the same site were never observed interacting. Here we show a histogram of the number of observed interactions within pairs of co-occurring species. \textbf{E-F)} Here we show, for each species pair, the number of observed interactions plotted against the number of observed co-occurrences. Most pairs either are never observed interacting or interact almost every time they co-occur. The red, dashed line indicates a 1:1 relationship between interactions and co-occurrences.}
      \label{histograms}
      \includegraphics*[width=.8\textwidth]{figures/Salix_Galler_histogram.eps}
      \end{figure}

%DG: I really appreciate this figure, it makes the point so clear. 


    In this study, we develop analytical tools to capture the uncertainty in the estimation of pairwise interactions. We focus on binary interactions as a first step, but the framework could be expanded to deal with interaction frequencies and strength. To define the problem, we first discuss the pervasive implications of uncertainty in the estimation of pairwise interactions on the properties of ecological networks. We then define a framework which identifies and dissects the different contributions to uncertainty of interaction. We illustrate this framework with a simple quantitative example using the most extensively sampled network to date (see Box 1). Next, we use the framework to provide analytical criteria for improving the sampling of rare interactions. Finally, we offer tangible recommendations for improved descriptors of ecological interactions. Through these efforts, we demonstrate both the utility of our approach and the importance of acknowledging the uncertainty inherent in network studies.


\section*{Why do some interactions \emph{not} occur?}

  To define the problem associated with describing ecological interaction networks, we will start from the perspective of an empirical community ecologist faced with the task of describing an interaction network. This ecologist will be interested in generating a description of the blocks present, and the links between them (Roslin and Majaneva 2017).  Importantly, the information sought is conveyed by both the presence and \emph{absence} of links. An observed link will always remain an observed link, but as to why given links are not observed, there may be multiple contributions. Thus, we will set off by contemplating what factors may contribute to links missing from the matrix. We consider that there are three nested levels of uncertainty making the occurrence of any interaction a stochastic process:

    \subsection*{Interaction uncertainty} 

    First, and most fundamentally, we do not know whether or not a pair of species have the appropriate characteristics (or traits) to interact. We define the probability of an interaction $L$ given those characteristics $\mathbf{T}$ as $P(L | \mathbf{T})=\lambda$. Obviously, if $k$ (the number of observed interactions) is 0, it is possible that the two species cannot interact even if there were no time or environmental constraints preventing it to occur. In such case, $\lambda$ would take a value of 0. 
    % [[The previous sentence doesn't follow, k hasn't been defined and we don't know that it's zero. Also, are we assuming that these interactions have been observed over a large area/time like the Kopelke data? Otherwise couldn't something about that particular site prevent species interacting even if they otherwise could?]] 
    % [[With defining k I think this is fine... site uncertainty will come in later, and it's not necessary to assume anything about the sampling design to get from not observing two species to interact to suspecting that they don't (degree of confidence depending on the species involved). I've toned down "very likely" to "possible" though - does that help?]]
    But it is nonetheless possible that the interaction is a rare phenomenon that has never been documented before, with $\lambda>0$. This source of uncertainty is the one documented by trait-matching models~\citep{Bartomeus2016}. It arises because every model is imperfect and lacks information (i.e. traits) about the constraints on the interaction. In other words, with sufficient sampling and all information accessible, this interaction probability $\lambda$ should either tend to 0 or to 1 and the uncertainty vanishes. 
    % [[For species which actually co occur (?)]]
    % [[I think that gets covered under "sufficient sampling"]]

    \subsection*{Process uncertainty} 

    It could be that we know an interaction is feasible, i.e. $L=1$, but that it does not occur at a given location or moment in time because there are local constraints, such as inclement weather or lack of suitable habitat, that prevent the interaction from occurring. We define the realisation of the interaction process with the variable $X$, given that the interaction is feasible, as a stochastic process with associated probability $P(X|L)=\chi$. This phenomenon of interaction contingencies is usually not considered in network studies, but there is a rich literature in community ecology about the contingencies of interactions~\citep{}. 
    % We imagine for instance that an interaction between a gall and a parasitoid might not be recorded at a location because it was the wrong time of the year and the gall had not yet formed (phenological constraints), a late frost killed the larvae (an abiotic environmental constraint), another parasitoid species competitively excluded the parasitoid species of interest (a biotic environmental constraint) or simply the parasitoid is too rare to interact with all of its viable hosts (an abundance constraint). 

    \subsection*{Detection uncertainty} 

    Lastly, measurement errors are always a source of uncertainty in the observation of ecological processes. We define the detection of an interaction with the variable $D$, given an interaction is feasible and occurs in the local conditions, as a stochastic process with associated probability $P(D|X,L)=\delta$. Detection failure could happen for several reasons, for instance if the rearing of a parasitoid fails with inappropriate lab conditions, because of species mis-identification, or because the interaction is very rare. Some sources of detection error could be minimised with appropriate sampling effort ($\delta$ will converge to one with increasing number of samples), but other sources are often difficult to reduce (e.g. the occurrence of cryptic species might require molecular analysis for appropriate taxonomic identification).


    % \subsection*{What is an observation of "no interaction"?} 

    The combination of these three sources of uncertainty together leads to many potential explanations for the observation of an absence of interaction, but only the situation where $L = 0$ (a true absence) is relevant for the investigation of networks. While the observation of an interaction is straightforward to interpret, absence of interactions must be decomposed into different quantities. It is particularly important to rule out the situations where $D=0 \cup X = 1 \cup L=1$, i.e. the interaction occurred at the location but was not observed, and $D=1 \cup X = 0 \cup L =1$, the interaction is feasible and would have been detected but did not occur at the local site. Ecologists seek to measure the occurrence of true absences, which is the joint event $L=0 \cup X=1 \cup D=1$), but in reality they measure the marginal probability $P(L) = k/n$ where $k$ is again the number of observed interactions and $n$ the number of observed co-occurrences. % I'm pretty sure this should be L=0 but X=1 and D=1: interaction not feasible but site and detection perfect.
    %DG: YES

\section*{Estimating detection and process uncertainty}

  For the ecologist working on collecting network data, and on later interpreting these data, the considerations above raise a major challenge: how may we infer whether unobserved interactions went undetected due to sampling, or whether they truly do not occur. How then may we refine our sampling approaches to reduce uncertainties, and to gain insights into the impact of multiple processes on field observations? Importantly, some sources of uncertainty can be minimised with appropriate sampling design and efforts, while other sources are difficult or impossible to reduce – since they are generated by chance variation created by the very process in which we are interested.


  The basic information that we are collecting consists of matrices of interaction partners. Our count of interactions between two species reflects uncertainty with respect to whether two species are capable of interacting when co-occurring at a given site ($\lambda$), chance variation in whether the interaction is realised ($\chi$),  and uncertainty with respect to whether it is detected when realised ($\delta$). In this case, what can we do to pin down any of these different types of variation?

% DG: it's bizarre to present here the outcome of the naive binomial formulation, while the reasoning is provided later. My solution is to move the following section on the binomial model along with the figure within a box. It's not central, but formalizes the problem. It would respect the order of appearance and better emphasize the bayes section.

  A simple example will illustrate the problem (the full reasoning is provided below): assume that we want to infer the probability of an interaction between two species, A and B. Now assume that in reality, interaction between A and B is completely impossible (i.e. the true $\lambda=0$), but the observer does not know it and seeks to estimate this interaction probability. The record of the number of observed interactions will follow a binomial distribution, with number of trials $k$ and number of observations $n$, for which we can compute the confidence interval of the estimated probability $\lambda$. Given no added detection error in observing the incidence of the interaction, then a single observation of species co-occurrence will reveal (very) little regarding the probability of the interaction – the confidence limits for one observation essentially spans from 0 to 1 (Fig.~\ref{upper_limits} - using Clopper-Pearson's true confidence interval). For 5 observations, this confidence limit still extends to 0.5. Only with thirty observations will it shrink to 0.1. Thus, adding (many) more observations is certainly useful in controlling uncertainty due to stochasticity inherent in the process itself, but the number of observations nonetheless needs to be very high. 

  \begin{figure}
    \caption{This figure illustrates the upper bound (solid black line) of a 95\% confidence interval for the interaction probability $\lambda$ when there is no observation of an interaction ($k = 0$) and $n$ observations of the two species co-occurring at a given location. The confidence interval is based on the Clopper-Pearson derivation from the beta distribution. A threshold interaction probability of 0.1 is indicated by the dotted red line.}
    \label{upper_limits}
    \includegraphics*[width=.8\textwidth]{figures/upper_limit_DG.eps}
  \end{figure}


  The obvious rule of thumb derived from the above example is ``sample more", but we note that there are limits to the utility of this motto. Sampling more will clearly reduce uncertainty regarding the upper bound of the probability of interaction, and it will also increase the probability of detecting unlikely interactions (i.e. interactions occurring with a low probability). Yet, since the probability of observing the co-occurrence of two species will always be higher than the probability of observing their interaction (since the probability of interaction is conditional on both interaction partners being present), we will accumulate observations of co-occurrences faster than we will accumulate observations of interactions. Thus, the more we sample, the more zeros will appear in our interaction matrix, which may seem like a counter-intuitive outcome. 


  As a solution towards deciding whether unobserved interactions were undetected due to sampling, or whether they truly do not occur,~\citet{Weinstein2017} used repeated sampling rounds to estimate the daily probability of detecting a hummingbird interaction, and to thereby model the observation and process mechanisms. While conceptually attractive, this approach is unsuitable for interactions occurring over longer time scales (e.g., associations between hosts and parasitoids with a single generation per year), or very rare interactions (since no matter how frequently and extensively we sample, there will still be some interactions lurking around). What is worse, the problem persists that if a given interaction is not observed on a given day, this could be either because it was impossible that day despite being otherwise feasible (P($X|D=1,L=1$=0), because interaction between the two did occur but could not be observed (P($D|X$=1,L=1)=0), or from any combination of the two. From a conceptual perspective, this approach will thus fail to satisfactorily distinguish between sources of uncertainty. An interaction not observed on day $t$ may have gone undetected either because there were constraints on the process (i.e. the probability $\lambda$ was really zero) or because of chance variation in the realised incidence of an event associated with a finite probability. Most importantly, if two species are never observed co-occurring during several days of sampling then we have learned nothing about their probability of interacting if they should ever co-occur. In other words, there is no information without co-occurrence.


  An added complication is that not all sources of uncertainty are proportional to sample size. To record an interaction between A and B, we need to identify both partners correctly (a non-trivial problem in many food webs; e.g.~\citet{Kaartinen2011,Roslin2016}) and be able to resolve all interactions with a similar likelihood. For both molecular~\citep{} and rearing~\citep{} techniques, certain types of interactions may go unnoticed due to technical challenges. This can bias the set of recorded interactions.

% DG : I propose to maintain part of this paragraph that was commented out, just to keep the transition. 
The bottom line is that separating different sources of uncertainty is difficult indeed. As an alternative to abandoning empirical networks or continuing to ignore the uncertainty inherent in undetected observations, we propose that some insight regarding the detectability of interactions between species not found co-occurring may be gained from data on other species between which interactions are known to be feasible. 

  % [[How do we define samples? For the Kopelke set we use sampling occasion, but what about sampling twice as many trees on the same day and same place? Does that count? Does it have to be spatially and/or temporally separated? Is it relevant??]]
  % [[Pretty sure this will always depend on the study - also seems like a pretty large digression.]]

  % The bottom line is that separating different sources of uncertainty is difficult indeed. In the best of all possible worlds, we might use an experimental approach to estimate detection uncertainty by creating replicate cases where the interaction really occurs and then evaluating the fraction of cases where the interaction is detected. Yet, as anyone attempting these experiments will know, most interaction partners are notoriously unwilling to collaborate. Gallers refuse to lay eggs on their host plants in captivity (ref ref) and parasitoids decline to attack their hosts when experimentally introduced (Gariepy 2017; ref ref). If we introduce only one of the components (as in the cases where we expose a set of hosts to parasitism; ref ref; Gripenberg et al. xxx) then we are already confounding multiple levels of uncertainty since it is not certain whether the interaction will occur or whether we can detect it. To perform these experiments in a comprehensive and reliable manner, we will then need to replicate a large number of interactions in a comprehensive experiment across space. This type of “cafeteria experiments in space” is not only unfeasible, but also undermines our original objective: If the local occurrence of interactions is uninformative regarding the underlying probabilities of occurrence, then is not likely to be worthwhile collecting these local interaction matrices in the first place. <deep sigh and forget that section? > 


  % As an alternative to abandoning empirical networks or continuing to ignore the uncertainty inherent in undetected observations, we propose that some insight regarding the detectability of interactions between species not found co-occurring may be gained from data on other species between which interactions are known to be feasible. If we use this information obtain the joint probability of detection and process (e.g. to glean information regarding at how many sites the species are found interacting across the entire dataset), and assuming that most of this pattern is due to variation in detection rate, then insights into the incidence of interactions between species may be gleaned from the accumulation rate of positive interactions at sites were interaction is possible (i.e. with at least one observation of a positive interaction) [this reasoning to be further formalised]


\section*{A naive quantification of interaction probability and uncertainty}

  % It is getting more and more common to represent interactions as probabilities in theoretical models of network structure. For example, the minimum potential model introduces gaps in the feeding niche of predators by sampling based on the likelihood of each interaction~\citep{Allesina2008}, while a gaussian probability function is used to represent the niche by~\citet{Williams2010}. \citet{Eklof2013} also introduced variability  in the computation of network dimensions, allowing the absence of interactions within the n-dimension niche of every species. Empirical investigation of trait-matching constraints often consider the occurrence of interactions as binomial process (e.g.,~\citealp{Rohr2016}). There are also ways to perform analysis of probabilistic networks, with almost all metrics having a probabilistic version~\citep{Poisot2016}. But there is not yet consensus on what an interaction probability between a pair of species means, and this is definitely a problem when comes time to estimate the uncertainty of both pairwise interactions and entire networks. 


  To progressively dissect the different contributions to uncertainty, we will start by considering how we could naively quantify interaction probability and its associated uncertainty \emph{for an interaction that has not yet been observed}. We consider that a pair of species have been observed $n$ times co-occurring at one location, and the number of times they have been observed interacting is $k = 0$. We now aim to evaluate the uncertainty of this interaction. The occurrence of an interaction is a Bernoulli trial. Consequently, the number of successes $k$ over $n$ trials will follow a binomial distribution: 
      
      \begin{equation}
        X \sim Bin(n,\lambda) ,
      \end{equation}

      \noindent and 

      \begin{equation}
         P(X = k|\lambda,n) = {n \choose k}\lambda^k(1-\lambda)^{n-k} . 
         \label{likelihood}
      \end{equation}

  \noindent The parameter $\lambda$, the probability of observing an interaction over an infinite time interval and area, is the quantity we want to estimate from empirical data. 
  The maximal likelihood estimate (MLE) of $\lambda$ is straightforward to find given $k$ and $n$:

      \begin{equation}
        \theta_{MLE} = \frac{k}{n}  .
        \label{theta_MLE}
      \end{equation}

  The variance of a Bernoulli experiment is $n\lambda$(1-$\lambda$). It is important to remember that this variance describes the variability of the number of success[es] $k$ for $n$ trials and is not the variance associated with the estimation of $\lambda$.
  Given this variance, it is possible to compute the confidence interval for the MLE of $\lambda$ using any of several methods, including the \emph{Wilson score interval}, the \emph{Clopper-Pearson interval}, and the \emph{Agresti-Coull Interval} (for details, see [\citealp{}]). Finding this estimate is therefore quite straightforward, but it nonetheless has two drawbacks. First, $\lambda$ is not a single point estimate but rather a random variable with a given uncertainty, the distribution of which is unknown. This means that even if $k = 0$ in a given sample, this does not necessarily imply that the two species will never interact. What it implies is that no interaction is the most likely situation but there is nonetheless a significant chance that the two species \emph{could} interact. In contrast with the situation where $k>0$, when we are sure that an interaction is feasible, 
  % (in which case, the ratio $k/n$ is smaller than $n$ because of detection and process uncertainty),  % This parenthetical makes the sentence very long. Is it necessary?
  we are not sure that absence of interactions is caused by $L=0$. Second, and most importantly, the number of trials $n$ might be very low in many instances (and some pairs of species might not have been documented as co-occuring in even one case). Consequently, the uncertainty in the estimation of $\lambda$ might be considerable. In Fig.~\ref{upper_limits}, we derive the Clopper-Pearson interval to explore how the estimate of $\lambda$ varies with sample size. At a small sample size, the 95\% confidence interval spans all values of $\lambda$. To establish that species are not interacting with any acceptable certainty requires tens of observations of the two species co-occurring but not interacting.
  % Is the Clopper-Pearson interval the one in Dom's code snippets? If so, this is Fig.~\ref{Salix_cdfs}

% DG: The following should be removed to avoid repetitions
%  The situation where $k = 0$ is also problematic because we have very little information with which to estimate $\lambda$, in particular when $n$ is also small. We therefore propose a Bayesian approach to solve this problem, building on two relevant features of such statistics: the posterior distribution of parameter estimates and usage of prior information. Before moving to this direction, we will first take time to better describe what is exactly meant by an interaction probability and appropriately define sources of uncertainty.


%  So many sources of interaction pooled into a single entity; hard to estimate.

% MLE is zero if no interaction is detected, but there may still be a substantial probability of interaction should the two species co-occur. [This is particularly important in the context of a changing world, where species not co-occurring today – or species not detected co-occurring today – may well do so tomorrow, forming complex interactions.]


\section*{Bayesian approach to infer interaction probabilities}

    \subsection*{Posterior distribution of the interaction probability}

    %DG: note that I replaced theta by lambda to follow the above definitions. Need to make sure it's done throughout
    %DG: I realize there is an X in here that should be removed as well to avoid confusion with the above nomenclature

      We here adopt a Bayesian approach to estimate the distribution of the parameter $\lambda$. According to Bayes principle, the posterior distribution of $\lambda$ is:

      \begin{equation}
        \underbrace{P(\lambda|X,n)}_{Posterior} = \frac{\overbrace{P(X|\lambda,n)}^{Likelihood}\overbrace{P(\lambda)}^{Prior}}{\underbrace{P(X|N)}_{Normaliser}} .
        \label{posterior}
      \end{equation}

      According to the above description, the likelihood is simply the binomial distribution (Eq.~\ref{likelihood}). Since $\lambda$ is a probability it is bounded between 0 and 1 and consequently the most appropriate prior distribution is the beta:

      \begin{equation}
        \lambda \sim Beta(\alpha,\beta) , \label{prior}
      \end{equation}

      \noindent which has two shape parameters, $\alpha$ and $\beta$. 

     In some cases it can be complicated to compute the normaliser, but fortunately in our case an analytical solution exists. The beta-binomial distribution is a conjugate distribution of the binomial distribution. This allows us to analytically compute the posterior distribution of a binomial model with a beta prior distribution. We can re-write the posterior distribution of $\lambda$ as:

      \begin{equation}
        P(\lambda|k,n) = \frac{\lambda^{\alpha+k-1}(1-\lambda)^{\beta+n-k-1}}{B(\alpha+k,\beta+n-k)} , \label{posterior}
      \end{equation}

      

%      \begin{equation}
%        Beta(\alpha+k,\beta+n-k) = \frac{\Gamma(\alpha+k)\Gamma(\beta+n-k)}{\Gamma(\alpha+\beta+n)} . \label{betafunction}
%      \end{equation}

      \noindent where the function $B$ is the beta function. The posterior distribution of $\lambda$ therefore follows the beta distribution with new parameters $\alpha'= \alpha+k$ and $\beta'=\beta+n-k$. The weigth of the prior on the posterior distribution is understood from these definition of the parameters: the difference between the posterior and the prior will increase with $k$ and $n-k$. When plotted, we find the shape of the distribution gets narrower with $k$ and $n$ (Fig.~\ref{Salix_pdfs}). We also find an important difference between the salix-gallers and gallers-parasitoids because of the differences in the prior distributions. 
      %
      %  The posterior distribution of $\theta$ could be computed with R with the following command:
      %
      %
      %  \vspace{12pt}
      %  \noindent\emph{dbeta(x = theta, shape1 = alpha+k, shape1 = beta+n-k)}
      %  \vspace{12pt}


%DG :  I think we should add the MLE estimate along with the binomial confidence interval on the figure in order to better illustrate the impact of the prior (obviously only for one N). You may draw it with a line to contrast with polygons.

%DG: otherwise the difference between the two interaction types is very interesting and useful to show the effect of the priors. Bravo ! 
      \begin{figure}[ht]
        \label{Salix_pdfs}
        \caption{Using prior distribution based on the \emph{Salix}-galler and galler-parasitoid networks in~\citet{Barbour2016}, we can calculate posterior distributions for the probability of interaction ($\lambda$) between two species that have not yet been observed interacting. Here we show posterior distributions for each $\lambda$ in each network ranging from the prior distribution (N=0 observed co-occurrence) to the distribution obtained when the pair of species has been observed co-occurring 100 times. The distribution narrows and approaches zero as the sample size increases. \textbf{A)} The posterior distributions for the \emph{Salix}-galler component are always wider and farther from zero than those for \textbf{B)} the galler-parasitoid component. This is likely because the prior distribution for the galler-parasitoid component of the network was both narrower and had a mean closer to that in the~\citet{Kopelke2017} data than the \emph{Salix}-galler component.}
        \includegraphics*[width=.8\textwidth]{figures/Salix_Galler_pdfs_increasing_N.eps}
        \end{figure}

    \subsection*{Moments and other properties}

      The fact that the posterior distribution of $\lambda$ follows a beta distribution makes it straightforward to compute moments and other properties. 

      The \textbf{average} of $\lambda$ is: 
          \begin{equation}
            \bar{\lambda} = \frac{\alpha+k}{\alpha+\beta+n} ,
            \label{mean}
          \end{equation}

        and its \textbf{variance} is:  
          \begin{equation}
            Var(\lambda|k) = \frac{(\alpha + k)(\beta + n - k)}{(\alpha + \beta + n)^{2}(\alpha + \beta + n +1)}
            \label{variance}
          \end{equation}

        The \textbf{mode} of the distribution is:
          \begin{equation}
            \hat{\lambda} = \frac{\alpha + k - 1}{\alpha + \beta + n - 2} .
            \label{mode}
          \end{equation}

    \subsection*{The prior distribution}    

      Parameters $\alpha$ and $\beta$ determine the shape of the prior distribution, which follows a beta distribution. These are called hyper parameters. Below we identify four ways to formulate the prior distribution of $\lambda$. 

      \subsubsection*{Uninformative prior}
        
          In absence of any external information, an uninformative prior is the most conservative hypothesis for the distribution of $\lambda$. The beta distribution is in this case a uniform distribution, specified with hyper parameters $\alpha=1$ and $\beta=1$. 

      \subsubsection*{Distribution of connectance}
        
          In the literature of ecological networks there is a solid collection of data for which we know network connectance and from which we can define the connectance distribution. Connectance is measured as $C = L/S^2$, where $L$ is the number of interactions and $S$ is the number of species. It measures the filling of an interaction matrix and thereby expresses the average probability that any two species interact with each other. If we know only the mean $\overline{C}$ and the variance $\sigma_C^2$ of the distribution of $C$,
          % [[from the literature or from our network? Has to be from the literature - if it was our network we'd know way more than just C]] 
          then the beta parameters could be computed as follows using the method of moments:

          \begin{equation}
          \alpha = \overline{C}(\frac{\overline{C}(1-\overline{C})}{\sigma_C^2}-1) ,
          \end{equation}

          \begin{equation}
          \beta = (1-\overline{C})(\frac{\overline{C}(1-\overline{C})}{\sigma_C^2}-1) .
          \end{equation}
    
          %  It is also possible to compute maximum likelihood estimates for a sample of the distribution of $C$.
          %  
          %   The following piece of R code provides an example: 
          %
          %  \vspace{12pt}
          %  \noindent\emph{
          %    library(MASS)\\
          %    pars = fitdistr(x = vecC, "beta", start = list(shape1 = 1, shape2 = 1))\$estimate
          %  }
          %  \vspace{12pt}
          %
          %
          %  Where $vecC$ is a vector of known connectances for a set of networks. 


      \subsubsection*{Degree distribution for the species in the network - or - Interaction probabilities in a similar network}.

          [[Should we still have this? At the workshop we talked about how interaction probabilities depend on the degrees of both species and so I'm using predicted interaction probabilities (degreeA*degreeB) in the galler example. A writeup for that process follows the original text:]]

%DG: I think so, it is a very useful proposition in the paper to increasingly improve the quality of the prior. I just tried to cut it down in order to follow the above layout. 
%DG: actually, once I got down to the following section, I realized that the example is based on the degree distribution, so there is not much choice to keep it

          The degree of a node in a network is defined as the number of interactions it has to other nodes. The degree distribution of a network is then the probability distribution of these degrees over the whole network and the standardised degree could therefore be interpreted as an interaction probability. It is consequently possible to use the degree distribution to inform the prior distribution. The degree distribution could come from several networks, from a similar network (e.g. a known network at slightly different location) or from the network of interest if interaction probabilities for some species are already documented. The latter approach allows us to apply information from known, abundant species to the rarest species for which interactions are less frequently documented. The procedure for the estimation of the hyper parameters follows the same approach as described above for connectance except that each measurement is at the individual species level instead of the network level.
         
          If our focal network describes a similar system to that in a known network, we can use the distribution of interaction probabilities in that network to inform our prior. The probability of any interaction $L_ij$ depends on the degrees of species $i$ and $j$. Using normalised degrees $\Delta_i$ and $\Delta_j$ (i.e., degrees divided by the number of species in the network), we can obtain the probability of interaction $L_ij$=$\Delta_i\times\Delta_j$. The distribution of these interaction probabilities derived from a similar network or a suite of networks can be used to establish a prior distribution before any data from the focal network are collected. We could also use this approach to build a prior distribution using known interaction probabilities for some species in the focal network. The latter approach allows us to apply information from known, abundant species to the rarest species for which interactions are less frequently documented. The procedure for the estimation of the hyper parameters follows the same approach as described above for connectance except that each measurement is at the individual interaction level instead of the network level.


      \subsubsection*{Trait-matching function}. 

          [Tomas adds: This is a bit of a stump]
%DG: I tried to expand just a little, but I don't want to get lost in this paragraph as it would be a distraction. We should basically mention it as a possibility.

          The last approach we envision to document the prior distribution of $\lambda$ is to use the outcome of a trait-matching model, provided such a model has been documented using external data and relevant traits are available. 
          In such as case, the prior distribution would follow the function $P(\lambda|\mathbf{T})=f(\mathbf{T})$ based on a set of traits for both species $\mathbf{T}$. There are several techniques available to perform this inference of interaction probability, some of which are bayesian, and we refer to ~\citep{Bartomeus2016} and \citep{Weinstein2017} for recent reviews about this topic. Note that in this case the prior might not be beta distributed and numerical methods might be required to compute the posterior distribution.  

%DG: I want to be sure that the following example is clear and understandable for everyone. Tomas, Kate, both of you can follow the entire logic ? Would you be able to reproduce it using the R code ? 

\section*{A quantitative example}

  %Perhaps we want to also have a trait matching example in addition to the degree distribution example below?
%DG: that would be great, but I think it will be simply too much and too mathy. 

  % Are degree distributions valid priors for interaction probabilities in a unipartite web? For the Salix-gall dataset we're using interaction probabilities as priors (since the degree of both Salix and galler matter)... maybe we should rephrase this to predict the degree of species $i$ based on the degrees of 10 other species in the network?
  The Bayesian framework can be illustrated with a simple quantitative example. Suppose we have $n = 10$ observations of co-occurrence between species $i$ and species $j$ in a given time interval and area, and $k = 3$ observations of interactions. The maximum likelihood estimate of the interaction probability (Box 1) is simply $\lambda_{MLE} = 3/10 = 0.3$. 
  % We should probabaly have a value  on the interaction probablitity that differs from the average of the degree distrbution
  
%DG: the following example should provide first the real degree, and below the normalized degree. We need to help the reader translating degrees into interaction probabilities

  Now consider we know that species $i$ is known to interact with 10 species (other than species $j$), which have the following normalised degrees:

    \vspace{12pt}
    \noindent\emph{
       degree = c(0.66, 0.18, 0.12, 0.16, 0.84, 0.32, 0.12, 0.76, 0.06, 0.04)
        }.
      \vspace{12pt}

    If the network has 20 species total, then species $i$ has a normalised degree of 0.5 and
    we can use this to obtain the following set of interaction probabilities for species $i$ and each of its interaction partners:

    \vspace{12pt}
    \noindent\emph{
       int\_probs = c(0.33, 0.09, 0.06, 0.08, 0.42, 0.16, 0.06, 0.38, 0.03, 0.02) }.
      \vspace{12pt}

    The mean of these interaction probabilities is 0.163, approximately half the $\lambda_{MLE}$ obtained from the observed data. We can use the distribution of these interaction probabilities as our prior distribution and estimate the uncertainty surrounding our $\lambda_{MLE}$. With some simple R code (function calculate\_parameters, \emph{Appendix S2}), we obtain prior parameters $\alpha$=1.050830 and $\beta$=5.365892. Using these priors in equations~\ref{mean} and~\ref{variance} above (or in the R function calculate\_distribution in \emph{Appendix S2}), we find a prior mean interaction probability of 0.16376436 and a prior variance of 0.02134199. Adding the observed data ($n=10$, $k=3$) and using the same code, we obtain posterior parameters $\alpha'$=4.05083 and $\beta'$=12.36589 and a posterior distribution of $\lambda$ with mean 0.247 and variance 0.011. Comparing the posterior distribution to the prior, we see that the posterior is closer to the observed data and that the additional data has reduced the variance. We may also wish to calculate a credible interval (analogous to the frequentist confidence interval). This is also quite straightforward in R (see function credible\_interval in \emph{Appendix S2}). In this case, a 95\% credible interval for the mean of theta is (0.077, 0.474).

    Now, consider the case where the two species have never been observed interacting across $n$ trials, i-e. $k=0$. The question is then ``what is the probability these two species do not interact''? Since it is not possible to prove that the two species could never interact (strickly speaking, in such an approach $\lambda=0$ is impossible), given the framework above we must fix a threshold below which we consider that there is no interaction ($\lambda \sim 0$). We call this threshold probability $\lambda*$. We then use the cumulative distribution function to estimate $P(\lambda<\lambda*|L=0,n)$ for different $n$. The 
    function plot\_precision in \emph{Appendix S2} calculates distribution function for $\lambda*$ with an increasing number of trials. The figure below illustrates this distribution for $\lambda*$=0.1. This yields a surprising result: it requires \textgreater24 observations of no interactions to be 95\% sure that the interaction probability is smaller than 0.1 (recall Fig.~\ref{upper_limits}). Note the special case where there is no observation of the two species co-occurring, $n = 0$  In this situation, the posterior distribution converges to the prior distribution since the data include no information on the probability with which species might interact should they co-occur; see above).

\section*{Scaling up uncertainty from pairwise interactions to networks}

    It is fairly straightforward to compute most of network metrics when the different $\lambda$ of the adjacency matrix are known, without variance~\citep{Poisot2016}. Several of these metrics derive directly from quantitative indices of network structure which are equivalent to $\lambda$; the remainder, originally defined for binary networks, can be adjusted to account for interaction probabilities between zero and one. It is not as easy, however, to understand how the uncertainty in these estimated interaction probabilities influences network metrics. Computation of these metrics involves non-linear functions and therefore, because of Jensen's inequality (which states that the average of non-linear function of a stochastic variable differs from the function of the average of that variable), any uncertainty in $\lambda$s could bias both the mean and variance of a network metric. For instance, assume that among all pairs of species with few observed co-occurrences there are many pairs which truly interact. If we begin with no observed links for these pairs, then correcting for these false absences will inflate the number of links and consequently influence metrics such as connectance, nestedness, and degree distribution. While we can, as described above, calculate these network metrics using fixed estimates for $\lambda$, no analytical solution currently exists for uncertain $\lambda$. Instead we must rely on computer simulations. In the following section, we will provide an empirical example, based on the data set published by~\citet{Kopelke2017}. We will show how the uncertainty arising from both absences of co-occurrences and false absences of interactions impact these metrics. %We find uncertainty influences both the average and the variance of network metrics, putting in perspective traditional network comparison studies where these metrics are assumed to be fixed entities. 

%\section*{Case study: estimating the uncertainty of a plant-herbivore network}

    \subsection*{Description of the data}

      We use an extensively sampled \emph{Salix}-galler-parasitoid meta-network as a case study. This dataset consists of a single community type sampled across Europe; willow (\emph{Salix}) species, willow-galling sawflies (Hymenoptera, Tenthredinidae, Nematinae, Euurina), and their natural enemies (hymenopteran parasitoids and coleopteran, lepidopteran, dipteran, and hymenopteran inquilines). The data were collected over 29 years (1982-2010) at 374 unique locations across Europe ranging from Sicily to the Arctic. Including repeated visits to a number of sites, the data set contains 641 site-visits, each of which can be considered as a network in its own right. Here we consider each network as an independent sample from which to build the meta-network. The meta-network consists of 1,173 different interactions between 52 \emph{Salix} nodes, 92 herbivore nodes and 126 natural enemy nodes. Interactions were determined by dissecting and rearing gall inhabitants from 165,424 galls. The high spatiotemporal resolution of this network and the unusually high sampling effor implemented at the site level (641 site-visits, which can be considered as repeated samples of the network) makes this dataset particularly well suited for testing this method.


      Importantly, while large, this network illustrates the very real constraints on the sampling of ecological networks. As a baseline, we may compare the frequency of co-occurrence of taxa to reveal the challenge of having sufficiently large $n_{ij}$ (Fig.~\ref{upper_limits}). In the example data, most (3986 out of 4992) pairs of species are never found co-occurring, and for species found co-occurring the number of co-occurrences was generally low (Fig.~\ref{histograms}A). 
%DG: can you provide mean and variance in the text?
      Among the species which did sometimes interact when co-occurring, the incidence of interaction was actually low. 
%DG: in the following, would be useful to present both absolute and relative numbers, or just relative
      Only 141 pairs of species were observed interacting: of these, 26 were observed interacting only once and 48.2\% were observed interacting five or fewer times (Fig.~\ref{histograms}B). Thus, even in the most extensive data set that we could find, limited sampling is clearly a major source of uncertainty.

%DG: be careful : occurrence, not occurance on the figures
    \begin{figure}
      \caption{\textbf{A-B)} Most pairs of \emph{Salix} and galler or galler and parasitoid species were never observed co-occurring despite the high levels of replication in our example dataset. For those pairs that were observed together at least once ($n_{ij}>0$), the number of observed co-occurrences was generally small (\textless10). Here we show a histogram of the number of pairs of species observed co-occurring at least once. 3986 pairs of species were never observed co-occurring: these pairs are omitted from the histogram. \textbf{C-D)} Most pairs of species that were observed at the same site were never observed interacting. Here we show a histogram of the number of observed interactions within pairs of co-occurring species. \textbf{E-F)} Here we show, for each species pair, the number of observed interactions plotted against the number of observed co-occurrences. Most pairs either are never observed interacting or interact almost every time they co-occur. The red, dashed line indicates a 1:1 relationship between interactions and co-occurrences.}
      \label{histograms}
      \includegraphics*[width=.8\textwidth]{figures/Salix_Galler_histogram.eps}
      \end{figure}

%DG: I really appreciate this figure, it makes the point so clear. 
%    \subsection*{Finding the maximum likelihood estimate}

  \subsection*{Computing the posterior distribution}

      In a strict Bayesian framework, we wish to use a prior distribution that does not rely on any information from the study at hand. To that end, we use data from another well-described \emph{Salix} galler-parasitoid system~\citep{Barbour2016,Barbour2016Dryad}. Note that this study used several genotypes of \emph{S. hookeriana} rather than different \emph{Salix} species. We estimated frequencies of  \emph{S. hookeriana} genotype-galler interactions based on the normalised degree of each species in each network component (see \emph{Appendix S1} for details and code). Specifically, we obtain prior parameters $\alpha$=2.507217 and $\beta$=1.888079. For the galler-parasitoid component of the network, the corresponding prior parameters are $\alpha$=1.341479, $\beta$=9.487966. We are then able to use these priors to estimate the posterior distribution of interaction probabilities given the additional information in our dataset.
  
      For species where no co-occurrences were observed, we can 
      calculate the estimates for the mean and variance of 
      $\lambda_{ij}$ directly from this prior following 
      equations~\ref{mean} and~\ref{variance} 
      (see \emph{Appendix S2} for R implementation). The prior 
      distribution we obtain based on~\citet{Barbour2016,Barbour2016Dryad} is:
      $\hat{\lambda_{ij}}$=0.570, var($\lambda$)=0.056 for the \emph{Salix}-galler network and $\hat{\lambda_{ij}}$=0.124, var($\lambda$)=0.010 for the galler-parasitoid network. This is consistent with the prior data, where the average 
      interaction probability based on the degree distributions of Salix genotypes and gallers was 0.562 and that for gallers and parasitoids was 0.122. These probabilities are much higher than those in our dataset (0.028 and 0.078 for the \emph{Salix}-galler and galler-parasitoid networks, respectively). This discrepancy may reflect the differences in scale between a network containing different genotypes of a single \emph{Salix} species and four gallers from a single family and a network containing many \emph{Salix} species and gallers from many families as is the case in our dataset.

      For a pair of species where some co-occurrences were observed, we can update the prior distribution with these data. If we consider only pairs of species which were observed to co-occur but not to interact, $k_{ij}$ is always 0 and only $n_{ij}$ will vary between species pairs. Thus $\alpha'$=$\alpha$ and $\beta'$=$\beta + n$. At the most extreme case, for a pair of species which co-occurred at all 374 sites and was never observed to interact, our distributions would become:


      $\hat{\lambda_{ij}}$=6.625921 $\times$ 10$^{-3}$, var($\lambda_{ij}$)=1.739456 $\times$ 10$^{-5}$ for the \emph{Salix}-galler network and 
      $\hat{\lambda_{ij}}$=3.485906 $\times$ 10$^{-3}$, var($\lambda_{ij}$)=9.026737 $\times$ 10$^{-6}$ for the galler-parasitoid network.

      
      With species $i$ and $j$ co-occurring at all 374 sites and never being observed to interact, the maximum likelihood expectation for the probability of an interaction $ij$ is very close to 0 and the variance about this estimate is very narrow. In other words, we could establish with high certainty that the species will never interact. However, for most pairs of species $i$ and $j$, the species did not co-occur at many sites and our posterior mean and variance retain some of the influence of the prior. Nevertheless, as the number of observed co-occurrence increases, the posterior mean becomes closer to zero and the posterior variance decreases (Fig.~\ref{Salix_pdfs}).

%DG: the following subsection could be moved to the appendix if we need to cut down

  \subsection*{Computing the credible interval around a probability estimate}

      As well as obtaining posterior means and variances, it is possible to calculate a 95\% credible interval about the posterior mean. This is again straightforward to do in R (see the function ``credible interval" in \emph{Appendix S2}). Calculating the 95\% credible intervals for species pairs with 0 to 50 observed co-occurrences without any observed interaction (as in Fig.~\ref{Salix_pdfs}), we see that the interval narrows dramatically as the number of observations increases. In no case, however, does the confidence interval include 0. Even for a pair of species which appeared together in all 374 sites but were never observed interacting, the confidence interval (0.001, 0.018) comes close to, but does not include zero (Table~\ref{interval_table}). In other words, even with a very large data set, we will have problems in establishing that a given species pair can never interact.

      % # R code to make the table:
      % output=matrix(nrow=length(ns),ncol=5)
      % ns=c(0,1,2,5,10,15,20,25,50,100,150,200,374)
      % output[,1]=ns
      % for(r in 1:nrow(output)){
      %   interval1=credible_interval(calculate_parameters(sg_int_probs,ns[r],0),0.025,0.975)    
      %   interval2=credible_interval(calculate_parameters(gp_int_probs,ns[r],0),0.025,0.975)    
      %   output[r,2:3]=interval1
      %   output[r,4:5]=interval2
      % }

      \begin{table}[h]
        \caption{95\% credible intervals for the interaction probability of two species that co-occur in $N$ sites but are never observed to interact, obtained using prior information from the \emph{Salix}-galler network in~\citet{Barbour2016,Barbour2016Dryad}. [Tomas notes that this is conceptually very similar to Fig.~\ref{Salix_pdfs}]}
        \label{interval_table}
        \begin{tabular}{l | c c | c c }
        \multirow{2}{*}{N} & \multicolumn{2}{c}{\emph{Salix}-galler} & \multicolumn{2}{c}{galler-parasitoid}\\
         & Lower bound & Upper bound \\
        \hline
        0   & 0.152 & 0.931 & 0.008 & 0.364 \\
        1   & 0.110 & 0.843 & 0.007 & 0.337 \\
        2   & 0.087 & 0.760 & 0.006 & 0.313 \\
        5   & 0.053 & 0.573 & 0.005 & 0.258 \\
        10  & 0.033 & 0.400 & 0.004 & 0.200 \\
        15  & 0.023 & 0.306 & 0.003 & 0.163 \\
        20  & 0.018 & 0.247 & 0.003 & 0.137 \\
        25  & 0.015 & 0.208 & 0.002 & 0.119 \\
        50  & 0.008 & 0.115 & 0.001 & 0.071 \\
        100 & 0.004 & 0.061 & 0.001 & 0.039 \\
        150 & 0.003 & 0.041 & \textless0.001 & 0.027 \\
        200 & 0.002 & 0.031 & \textless0.001 & 0.021 \\
        \hline
        374 & 0.001 & 0.017 & \textless0.001 & 0.011 \\
        \hline
        \end{tabular}
        \end{table}


  \subsection*{How many samples are required to reach a minimal precision}

      Rather than calculating confidence intervals for a posterior distribution after collecting data, we may wish to know how many data points are necessary to obtain a given level of confidence that two co-occurring species do not interact. The number of samples needed will depend on both our desired level of confidence and the threshold below which we assume that two species are unlikely to ever interact. If we want to be 95\% confident that the interaction probability for two species in the \emph{Salix}-galler network is below 0.5, 0.1, or 0.01, we would need six, 51, and 101 observed co-occurrences with no observed interaction (Fig.~\ref{Salix_cdfs}; see function samples\_required in~\emph{Appendix S2}). Although the prior distribution of interaction probabilities is narrower and closer to zero for the galler-parasitoid network, the number of samples required to be 95\% confident that the interaction probability is below a threshold still increases quickly; we would need 25 and 101 observed co-occurrence with no observed interaction for threshold interaction probabilities of 0.1 and 0.01, respectively. Given the low levels of replication in most network studies, this implies that we should have fairly low confidence in many ``non-interacting" pairs of species. Even in the extensively replicated \emph{Salix}-galler-parasitoid dataset very few species pairs were observed co-occurring frequently enough to reach these thresholds (only three \emph{Salix}-galler pairs and 31 galler-parasitoid pairs were observed co-occurring frequently enough to reach the threshold for an interaction probability of 0.1, and no pairs were observed co-occurring frequently enough to reach the threshold for an interaction probability of 0.01 [[Do we need the other thresholds? Seems like it'll get redundant]]). Discounting potential interactions, then, requires either a stronger prior expectation of no interaction (e.g., we can be highly confident that a palm tree will not predate upon a leopard no matter how many times the two species are observed together) or very extensive sampling.


      \begin{figure}[ht]
        \caption{The number of samples required to achieve a given level of confidence that an interaction probability is below a given threshold varies with both parameters. With a low threshold, our confidence that $\omega_{ij}$ is below the threshold increases rapidly with repeated observation of co-occurrence without interaction. Here we show the cumulative density functions for thresholds probabilities of 0.5 (solid line), 0.25 (dashed line), 0.1 (dash-dot line), and 0.05 (dotted line) as well as the points at which the cdf reaches 0.90 (orange square), 0.95 (red circle), and 0.975 (blue diamond) for each threshold value. The large ticks along the x-axis indicate the number of samples associated with each of these points. Note that the number of samples required to reach any given threshold is smaller for \textbf{A)} the \emph{Salix}-galler network than for \textbf{B)} the galler-parasitoid network.}
        \label{Salix_cdfs}
        \includegraphics[width=.8\textwidth]{figures/Salix_Galler_samples_and_cdfs.eps}

        \end{figure}


  \subsection*{Scaling up to network metrics}

    Using the prior distributions and procedures described above, we calculated posterior probability distributions for each pair of \emph{Salix} and galler or galler and parasitoid species that were not observed interacting. Using these posterior distributions and assuming probabilities of 1 for pairs of species that were observed interacting, we created a suite of 100 webs of each network type by randomly sampling from each posterior distribution. After obtaining these posterior networks, we calculated the connectance of each web, as well as the number of links per resource (\emph{Salix} in the \emph{Salix}-galler networks or galler in the galler-parasitoid networks) and links per consumer. To demonstrate how these network metrics will be affected by detection uncertainty ($\delta$), we then created a suite of filtered networks for each posterior network. Networks were filtered by randomly sampling 99\%, 95\%, 90\%, 80\%, 70\&, 60\%, and 50\% of the interactions included in each posterior network. This gradient is akin to a gradient of sampling effort. For each level of detection accuracy, we created 100 randomly-sampled networks per posterior-probability network. We then calculated the same network properties as described above.

%DG: the different posterior connectance are the results of different samples of the posterior distribution, righ ? 

    We find, not surprisingly, that the posterior webs for the Salix-galler network all had much higher connectance than the original, observed web (C=0.028 for the observed web, Fig.~\ref{posterior_webs}). Likewise, the number of links per \emph{Salix} and galler species in the observed web (2.71 and 1.47, respectively) were much lower than those predicted in the posterior webs, even when filtering with a detection probability of only 50\%. There are two possible explanations for this discrepancy: either the~\citet{Barbour2016} data do not give an appropriate prior for our dataset, or the true detection probability for links between \emph{Salix} and galler species is much less than 50\%. As the scale of the two datasets is quite different (genotypes of a single \emph{Salix} species in~\citet{Barbour2016}, various \emph{Salix} species in our dataset), we suspect the former is more likely.


    Considering the galler-parasitoid networks, the connectance, mean links per galler, and mean links per parasitoid (0.078, 9.99, and 7.45, respectively) are similar to those in the posterior webs with a detection filter of 50\% (Fig.~\ref{posterior_webs}). The~\citet{Barbour2016} network likely provides a better prior here than for the \emph{Salix}-galler networks, as both networks included different galler and parasitoid species. Although the two networks differ vastly in scale, and the inclusion of multiple \emph{Salix} species likely causes structural differences from~\citet{Barbour2016} despite the similar resolution of gallers and parasitoids, this result nevertheless suggests that even such a large and well-replicated network is missing a large proportion of interactions. This should be a strong warning to researchers comparing structural characteristics between networks - small structural differences are very likely to be completely masked by structural changes that would result if missing interactions were included.


    \begin{figure}[ht]
    \caption{Here we show the mean connectance, links per resource (\emph{Salix} in the \emph{Salix}-galler networks and gallers in the galler-parasitoid networks), and links per consumer (gallers in the \emph{Salix}-galler networks and parasitoids in the galler-parasitoid networks) for networks assembled using posterior distributions based on~\citet{Barbour2016,Barbour2016Dryad}. We created 100 ``posterior-sampling" networks and then, for each of these, created 100 ``detection-filter" networks by randomly sampling 50\%-99\% of the interactions included in the posterior-sampling network. This simulates imperfect detection of interactions in the field. Each point represents the mean network property (e.g., connectance) obtained from a set of 100 detection-filter networks, plotted against the value of the network property in the posterior-sampling network used to create the detection-filter networks. For each property and both network types, the posterior-sampling networks cover a relatively small range of network properties and the value of each property decreases with the proportion of links included in the detection-filter networks.}
    \label{posterior_webs}    
    \includegraphics[width=.8\textwidth]{Figures/Salix_Galler_posterior_properties.eps}
    \end{figure}

  % [[What if we have only one site? Can we use the number of observations of a pair of species interacting with any partners as the number of times they co-occur, and the number of interactions within the pair as k? This will be sort-of valid for insects but not for plants when researchers camp out by plant individuals... ]]

\section*{Conclusions/recommendations}

  [Here we need to be very hands-on and remember the invitation letter form Ecol Letters:
  As a contribution primarily to methodology, the manuscript will not be considered for ``Ideas \& Perspectives". (Please recall my message concerning your past presubmission inquiry.) However, Ecology Letters is entertaining the idea of a new section for ``Novel Methods". As we have not advertised this, I would ask you to keep that information in confidence. If acceptable to an Associate Editor and reviewers, your paper could be the first, or one of the first, contributions to this new section. Accordingly, the work would be subject to considerable scrutiny and I would urge you to make the paper as strong as you can. This would include demonstrating the need for this new method (i.e. outlining how this is different than other approaches currently in use and how they fail at some important task), documenting the robustness and accuracy of the approach, performing case study, and making robust high-quality code freely available.]



\clearpage

    \bibliographystyle{ecollett} 
    \bibliography{MyCollection} % Abbreviate journal titles.


\end{document}


